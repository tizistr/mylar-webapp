import{_ as _e}from"./index-XKAoLoTg.js";const ns=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>_e(async()=>{const{default:s}=await Promise.resolve().then(()=>ke);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class lt extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class os extends lt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class as extends lt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ls extends lt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var et;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(et||(et={}));var cs=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(c){try{d(s.next(c))}catch(h){o(h)}}function a(c){try{d(s.throw(c))}catch(h){o(h)}}function d(c){c.done?i(c.value):r(c.value).then(l,a)}d((s=s.apply(n,e||[])).next())})};class ds{constructor(e,{headers:t={},customFetch:s,region:r=et.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=ns(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return cs(this,void 0,void 0,function*(){try{const{headers:r,method:i,body:o}=t;let l={},{region:a}=t;a||(a=this.region),a&&a!=="any"&&(l["x-region"]=a);let d;o&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",d=o):typeof o=="string"?(l["Content-Type"]="text/plain",d=o):typeof FormData<"u"&&o instanceof FormData?d=o:(l["Content-Type"]="application/json",d=JSON.stringify(o)));const c=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),r),body:d}).catch(y=>{throw new os(y)}),h=c.headers.get("x-relay-error");if(h&&h==="true")throw new as(c);if(!c.ok)throw new ls(c);let u=((s=c.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),g;return u==="application/json"?g=yield c.json():u==="application/octet-stream"?g=yield c.blob():u==="text/event-stream"?g=c:u==="multipart/form-data"?g=yield c.formData():g=yield c.text(),{data:g,error:null}}catch(r){return{data:null,error:r}}})}}var W=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ct(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function hs(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var K={},dt={},Fe={},Le={},Ne={},ze={},us=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},xe=us();const fs=xe.fetch,Ot=xe.fetch.bind(xe),Lt=xe.Headers,ps=xe.Request,gs=xe.Response,ke=Object.freeze(Object.defineProperty({__proto__:null,Headers:Lt,Request:ps,Response:gs,default:Ot,fetch:fs},Symbol.toStringTag,{value:"Module"})),ms=hs(ke);var He={};Object.defineProperty(He,"__esModule",{value:!0});let ys=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};He.default=ys;var jt=W&&W.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ze,"__esModule",{value:!0});const vs=jt(ms),ws=jt(He);let bs=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=vs.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let r=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,l,a;let d=null,c=null,h=null,u=i.status,g=i.statusText;if(i.ok){if(this.method!=="HEAD"){const T=await i.text();T===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?c=T:c=JSON.parse(T))}const f=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),p=(l=i.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");f&&p&&p.length>1&&(h=parseInt(p[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(c)&&(c.length>1?(d={code:"PGRST116",details:`Results contain ${c.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},c=null,h=null,u=406,g="Not Acceptable"):c.length===1?c=c[0]:c=null)}else{const f=await i.text();try{d=JSON.parse(f),Array.isArray(d)&&i.status===404&&(c=[],d=null,u=200,g="OK")}catch{i.status===404&&f===""?(u=204,g="No Content"):d={message:f}}if(d&&this.isMaybeSingle&&(!((a=d==null?void 0:d.details)===null||a===void 0)&&a.includes("0 rows"))&&(d=null,u=200,g="OK"),d&&this.shouldThrowOnError)throw new ws.default(d)}return{error:d,data:c,count:h,status:u,statusText:g}});return this.shouldThrowOnError||(r=r.catch(i=>{var o,l,a;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(l=i==null?void 0:i.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(a=i==null?void 0:i.code)!==null&&a!==void 0?a:""}`},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}};ze.default=bs;var _s=W&&W.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ne,"__esModule",{value:!0});const xs=_s(ze);let ks=class extends xs.default{select(e){let t=!1;const s=(e??"*").split("").map(r=>/\s/.test(r)&&!t?"":(r==='"'&&(t=!t),r)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:i=r}={}){const o=i?`${i}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const r=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){const i=typeof r>"u"?"offset":`${r}.offset`,o=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:i=!1,format:o="text"}={}){var l;const a=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,i?"wal":null].filter(Boolean).join("|"),d=(l=this.headers.Accept)!==null&&l!==void 0?l:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${d}"; options=${a};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Ne.default=ks;var Ss=W&&W.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Le,"__esModule",{value:!0});const Ts=Ss(Ne);let Es=class extends Ts.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(r=>typeof r=="string"&&new RegExp("[,()]").test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let i="";r==="plain"?i="pl":r==="phrase"?i="ph":r==="websearch"&&(i="w");const o=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};Le.default=Es;var $s=W&&W.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Fe,"__esModule",{value:!0});const $e=$s(Le);let As=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=t,this.schema=s,this.fetch=r}select(e,{head:t=!1,count:s}={}){const r=t?"HEAD":"GET";let i=!1;const o=(e??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",o),s&&(this.headers.Prefer=`count=${s}`),new $e.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const r="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),s||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const o=e.reduce((l,a)=>l.concat(Object.keys(a)),[]);if(o.length>0){const l=[...new Set(o)].map(a=>`"${a}"`);this.url.searchParams.set("columns",l.join(","))}}return new $e.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:r,defaultToNull:i=!0}={}){const o="POST",l=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&l.push(this.headers.Prefer),r&&l.push(`count=${r}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(e)){const a=e.reduce((d,c)=>d.concat(Object.keys(c)),[]);if(a.length>0){const d=[...new Set(a)].map(c=>`"${c}"`);this.url.searchParams.set("columns",d.join(","))}}return new $e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",r=[];return this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),this.headers.Prefer=r.join(","),new $e.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new $e.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Fe.default=As;var We={},Ye={};Object.defineProperty(Ye,"__esModule",{value:!0});Ye.version=void 0;Ye.version="0.0.0-automated";Object.defineProperty(We,"__esModule",{value:!0});We.DEFAULT_HEADERS=void 0;const Ds=Ye;We.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Ds.version}`};var It=W&&W.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(dt,"__esModule",{value:!0});const Cs=It(Fe),Rs=It(Le),Os=We;let Ls=class Pt{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=Object.assign(Object.assign({},Os.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=r}from(e){const t=new URL(`${this.url}/${e}`);return new Cs.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Pt(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:r=!1,count:i}={}){let o;const l=new URL(`${this.url}/rpc/${e}`);let a;s||r?(o=s?"HEAD":"GET",Object.entries(t).filter(([c,h])=>h!==void 0).map(([c,h])=>[c,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([c,h])=>{l.searchParams.append(c,h)})):(o="POST",a=t);const d=Object.assign({},this.headers);return i&&(d.Prefer=`count=${i}`),new Rs.default({method:o,url:l,headers:d,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}};dt.default=Ls;var Se=W&&W.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(K,"__esModule",{value:!0});K.PostgrestError=K.PostgrestBuilder=K.PostgrestTransformBuilder=K.PostgrestFilterBuilder=K.PostgrestQueryBuilder=K.PostgrestClient=void 0;const Mt=Se(dt);K.PostgrestClient=Mt.default;const Ut=Se(Fe);K.PostgrestQueryBuilder=Ut.default;const Bt=Se(Le);K.PostgrestFilterBuilder=Bt.default;const qt=Se(Ne);K.PostgrestTransformBuilder=qt.default;const Ft=Se(ze);K.PostgrestBuilder=Ft.default;const Nt=Se(He);K.PostgrestError=Nt.default;var js=K.default={PostgrestClient:Mt.default,PostgrestQueryBuilder:Ut.default,PostgrestFilterBuilder:Bt.default,PostgrestTransformBuilder:qt.default,PostgrestBuilder:Ft.default,PostgrestError:Nt.default};const{PostgrestClient:Is,PostgrestQueryBuilder:Ii,PostgrestFilterBuilder:Pi,PostgrestTransformBuilder:Mi,PostgrestBuilder:Ui,PostgrestError:Bi}=js,Ps="2.11.2",Ms={"X-Client-Info":`realtime-js/${Ps}`},Us="1.0.0",zt=1e4,Bs=1e3;var be;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(be||(be={}));var G;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(G||(G={}));var X;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(X||(X={}));var tt;(function(n){n.websocket="websocket"})(tt||(tt={}));var fe;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(fe||(fe={}));class qs{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const l=s.decode(e.slice(o,o+r));o=o+r;const a=s.decode(e.slice(o,o+i));o=o+i;const d=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{ref:null,topic:l,event:a,payload:d}}}class Ht{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var P;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(P||(P={}));const gt=(n,e,t={})=>{var s;const r=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,o)=>(i[o]=Fs(o,n,e,r),i),{})},Fs=(n,e,t,s)=>{const r=e.find(l=>l.name===n),i=r==null?void 0:r.type,o=t[n];return i&&!s.includes(i)?Wt(i,o):st(o)},Wt=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return Ws(e,t)}switch(n){case P.bool:return Ns(e);case P.float4:case P.float8:case P.int2:case P.int4:case P.int8:case P.numeric:case P.oid:return zs(e);case P.json:case P.jsonb:return Hs(e);case P.timestamp:return Ys(e);case P.abstime:case P.date:case P.daterange:case P.int4range:case P.int8range:case P.money:case P.reltime:case P.text:case P.time:case P.timestamptz:case P.timetz:case P.tsrange:case P.tstzrange:return st(e);default:return st(e)}},st=n=>n,Ns=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},zs=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},Hs=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},Ws=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,s=n[t];if(n[0]==="{"&&s==="}"){let i;const o=n.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>Wt(e,l))}return n},Ys=n=>typeof n=="string"?n.replace(" ","T"):n,Yt=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Ke{constructor(e,t,s={},r=zt){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var mt;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(mt||(mt={}));class De{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},r=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=De.syncState(this.state,r,i,o),this.pendingDiffs.forEach(a=>{this.state=De.syncDiff(this.state,a,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(s.diff,{},r=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=De.syncDiff(this.state,r,i,o),l())}),this.onJoin((r,i,o)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:i,newPresences:o})}),this.onLeave((r,i,o)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){const i=this.cloneDeep(e),o=this.transformState(t),l={},a={};return this.map(i,(d,c)=>{o[d]||(a[d]=c)}),this.map(o,(d,c)=>{const h=i[d];if(h){const u=c.map(p=>p.presence_ref),g=h.map(p=>p.presence_ref),y=c.filter(p=>g.indexOf(p.presence_ref)<0),f=h.filter(p=>u.indexOf(p.presence_ref)<0);y.length>0&&(l[d]=y),f.length>0&&(a[d]=f)}else l[d]=c}),this.syncDiff(i,{joins:l,leaves:a},s,r)}static syncDiff(e,t,s,r){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(i,(l,a)=>{var d;const c=(d=e[l])!==null&&d!==void 0?d:[];if(e[l]=this.cloneDeep(a),c.length>0){const h=e[l].map(g=>g.presence_ref),u=c.filter(g=>h.indexOf(g.presence_ref)<0);e[l].unshift(...u)}s(l,c,a)}),this.map(o,(l,a)=>{let d=e[l];if(!d)return;const c=a.map(h=>h.presence_ref);d=d.filter(h=>c.indexOf(h.presence_ref)<0),e[l]=d,r(l,d,a),d.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const r=e[s];return"metas"in r?t[s]=r.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var yt;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(yt||(yt={}));var vt;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(vt||(vt={}));var te;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(te||(te={}));class ht{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=G.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ke(this,X.join,this.params,this.timeout),this.rejoinTimer=new Ht(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=G.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(r=>r.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=G.closed,this.socket._remove(this)}),this._onError(r=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=G.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=G.errored,this.rejoinTimer.scheduleTimeout())}),this._on(X.reply,{},(r,i)=>{this._trigger(this._replyEventName(i),r)}),this.presence=new De(this),this.broadcastEndpointURL=Yt(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,r;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o,private:l}}=this.params;this._onError(c=>e==null?void 0:e(te.CHANNEL_ERROR,c)),this._onClose(()=>e==null?void 0:e(te.CLOSED));const a={},d={broadcast:i,presence:o,postgres_changes:(r=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(c=>c.filter))!==null&&r!==void 0?r:[],private:l};this.socket.accessTokenValue&&(a.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:d},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:c})=>{var h;if(this.socket.setAuth(),c===void 0){e==null||e(te.SUBSCRIBED);return}else{const u=this.bindings.postgres_changes,g=(h=u==null?void 0:u.length)!==null&&h!==void 0?h:0,y=[];for(let f=0;f<g;f++){const p=u[f],{filter:{event:T,schema:m,table:R,filter:x}}=p,_=c&&c[f];if(_&&_.event===T&&_.schema===m&&_.table===R&&_.filter===x)y.push(Object.assign(Object.assign({},p),{id:_.id}));else{this.unsubscribe(),e==null||e(te.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(te.SUBSCRIBED);return}}).receive("error",c=>{e==null||e(te.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(c).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(te.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,r;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((r=d.body)===null||r===void 0?void 0:r.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,a;const d=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((a=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||a===void 0)&&a.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=G.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(X.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const r=new Ke(this,X.leave,{},e);r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})})}async _fetchWithTimeout(e,t,s){const r=new AbortController,i=setTimeout(()=>r.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(i),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new Ke(this,e,t,s);return this._canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,i;const o=e.toLocaleLowerCase(),{close:l,error:a,leave:d,join:c}=X;if(s&&[l,a,d,c].indexOf(o)>=0&&s!==this._joinRef())return;let u=this._onMessage(o,t,s);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(g=>{var y,f,p;return((y=g.filter)===null||y===void 0?void 0:y.event)==="*"||((p=(f=g.filter)===null||f===void 0?void 0:f.event)===null||p===void 0?void 0:p.toLocaleLowerCase())===o}).map(g=>g.callback(u,s)):(i=this.bindings[o])===null||i===void 0||i.filter(g=>{var y,f,p,T,m,R;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in g){const x=g.id,_=(y=g.filter)===null||y===void 0?void 0:y.event;return x&&((f=t.ids)===null||f===void 0?void 0:f.includes(x))&&(_==="*"||(_==null?void 0:_.toLocaleLowerCase())===((p=t.data)===null||p===void 0?void 0:p.type.toLocaleLowerCase()))}else{const x=(m=(T=g==null?void 0:g.filter)===null||T===void 0?void 0:T.event)===null||m===void 0?void 0:m.toLocaleLowerCase();return x==="*"||x===((R=t==null?void 0:t.event)===null||R===void 0?void 0:R.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===o}).map(g=>{if(typeof u=="object"&&"ids"in u){const y=u.data,{schema:f,table:p,commit_timestamp:T,type:m,errors:R}=y;u=Object.assign(Object.assign({},{schema:f,table:p,commit_timestamp:T,eventType:m,new:{},old:{},errors:R}),this._getPayloadRecords(y))}g.callback(u,s)})}_isClosed(){return this.state===G.closed}_isJoined(){return this.state===G.joined}_isJoining(){return this.state===G.joining}_isLeaving(){return this.state===G.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),i={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(r=>{var i;return!(((i=r.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&ht.isEqual(r.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(X.close,{},e)}_onError(e){this._on(X.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=G.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=gt(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=gt(e.columns,e.old_record)),t}}const Js=()=>{},Ks=typeof WebSocket<"u",Vs=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Gs{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=Ms,this.params={},this.timeout=zt,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Js,this.conn=null,this.sendBuffer=[],this.serializer=new qs,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...l)=>_e(async()=>{const{default:a}=await Promise.resolve().then(()=>ke);return{default:a}},void 0).then(({default:a})=>a(...l)):o=fetch,(...l)=>o(...l)},this.endPoint=`${e}/${tt.websocket}`,this.httpEndpoint=Yt(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const r=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(r&&(this.accessTokenValue=r,this.apiKey=r),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Ht(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(Ks){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new Qs(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),_e(async()=>{const{default:e}=await import("./browser-CeS4uGgV.js").then(t=>t.b);return{default:e}},[]).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Us}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case be.connecting:return fe.Connecting;case be.open:return fe.Open;case be.closing:return fe.Closing;default:return fe.Closed}}isConnected(){return this.connectionState()===fe.Open}channel(e,t={config:{}}){const s=new ht(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:r,ref:i}=e,o=()=>{this.encode(e,l=>{var a;(a=this.conn)===null||a===void 0||a.send(l)})};this.log("push",`${t} ${s} (${i})`,r),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let s=null;try{s=JSON.parse(atob(t.split(".")[1]))}catch{}if(s&&s.exp&&!(Math.floor(Date.now()/1e3)-s.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`);this.accessTokenValue=t,this.channels.forEach(r=>{t&&r.updateJoinPayload({access_token:t}),r.joinedOnce&&r._isJoined()&&r._push(X.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Bs,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:r,payload:i,ref:o}=t;o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${s} ${r} ${o&&"("+o+")"||""}`,i),this.channels.filter(l=>l._isMember(s)).forEach(l=>l._trigger(r,i,o)),this.stateChangeCallbacks.message.forEach(l=>l(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(X.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return`${e}${s}${r}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([Vs],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class Qs{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=be.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class ut extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function z(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Xs extends ut{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class rt extends ut{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Zs=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(c){try{d(s.next(c))}catch(h){o(h)}}function a(c){try{d(s.throw(c))}catch(h){o(h)}}function d(c){c.done?i(c.value):r(c.value).then(l,a)}d((s=s.apply(n,e||[])).next())})};const Jt=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>_e(async()=>{const{default:s}=await Promise.resolve().then(()=>ke);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},er=()=>Zs(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield _e(()=>Promise.resolve().then(()=>ke),void 0)).Response:Response}),it=n=>{if(Array.isArray(n))return n.map(t=>it(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,s])=>{const r=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[r]=it(s)}),e};var pe=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(c){try{d(s.next(c))}catch(h){o(h)}}function a(c){try{d(s.throw(c))}catch(h){o(h)}}function d(c){c.done?i(c.value):r(c.value).then(l,a)}d((s=s.apply(n,e||[])).next())})};const Ve=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),tr=(n,e,t)=>pe(void 0,void 0,void 0,function*(){const s=yield er();n instanceof s&&!(t!=null&&t.noResolveJson)?n.json().then(r=>{e(new Xs(Ve(r),n.status||500))}).catch(r=>{e(new rt(Ve(r),r))}):e(new rt(Ve(n),n))}),sr=(n,e,t,s)=>{const r={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(r.body=JSON.stringify(s)),Object.assign(Object.assign({},r),t))};function je(n,e,t,s,r,i){return pe(this,void 0,void 0,function*(){return new Promise((o,l)=>{n(t,sr(e,s,r,i)).then(a=>{if(!a.ok)throw a;return s!=null&&s.noResolveJson?a:a.json()}).then(a=>o(a)).catch(a=>tr(a,l,s))})})}function qe(n,e,t,s){return pe(this,void 0,void 0,function*(){return je(n,"GET",e,t,s)})}function oe(n,e,t,s,r){return pe(this,void 0,void 0,function*(){return je(n,"POST",e,s,r,t)})}function rr(n,e,t,s,r){return pe(this,void 0,void 0,function*(){return je(n,"PUT",e,s,r,t)})}function ir(n,e,t,s){return pe(this,void 0,void 0,function*(){return je(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function Kt(n,e,t,s,r){return pe(this,void 0,void 0,function*(){return je(n,"DELETE",e,s,r,t)})}var J=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(c){try{d(s.next(c))}catch(h){o(h)}}function a(c){try{d(s.throw(c))}catch(h){o(h)}}function d(c){c.done?i(c.value):r(c.value).then(l,a)}d((s=s.apply(n,e||[])).next())})};const nr={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},wt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class or{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=Jt(r)}uploadOrUpdate(e,t,s,r){return J(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},wt),r);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const a=o.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),a&&i.append("metadata",this.encodeMetadata(a)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",o.cacheControl),a&&i.append("metadata",this.encodeMetadata(a))):(i=s,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,a&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),r!=null&&r.headers&&(l=Object.assign(Object.assign({},l),r.headers));const d=this._removeEmptyFolders(t),c=this._getFinalPath(d),h=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:i,headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{})),u=yield h.json();return h.ok?{data:{path:d,id:u.Id,fullPath:u.Key},error:null}:{data:null,error:u}}catch(i){if(z(i))return{data:null,error:i};throw i}})}upload(e,t,s){return J(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return J(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",t);try{let a;const d=Object.assign({upsert:wt.upsert},r),c=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&s instanceof Blob?(a=new FormData,a.append("cacheControl",d.cacheControl),a.append("",s)):typeof FormData<"u"&&s instanceof FormData?(a=s,a.append("cacheControl",d.cacheControl)):(a=s,c["cache-control"]=`max-age=${d.cacheControl}`,c["content-type"]=d.contentType);const h=yield this.fetch(l.toString(),{method:"PUT",body:a,headers:c}),u=yield h.json();return h.ok?{data:{path:i,fullPath:u.Key},error:null}:{data:null,error:u}}catch(a){if(z(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(e,t){return J(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);t!=null&&t.upsert&&(r["x-upsert"]="true");const i=yield oe(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),o=new URL(this.url+i.url),l=o.searchParams.get("token");if(!l)throw new ut("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(s){if(z(s))return{data:null,error:s};throw s}})}update(e,t,s){return J(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return J(this,void 0,void 0,function*(){try{return{data:yield oe(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(z(r))return{data:null,error:r};throw r}})}copy(e,t,s){return J(this,void 0,void 0,function*(){try{return{data:{path:(yield oe(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(z(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,s){return J(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),i=yield oe(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const o=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(r){if(z(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,s){return J(this,void 0,void 0,function*(){try{const r=yield oe(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:r.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(r){if(z(r))return{data:null,error:r};throw r}})}download(e,t){return J(this,void 0,void 0,function*(){const r=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield qe(this.fetch,`${this.url}/${r}/${l}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(z(l))return{data:null,error:l};throw l}})}info(e){return J(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield qe(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:it(s),error:null}}catch(s){if(z(s))return{data:null,error:s};throw s}})}exists(e){return J(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield ir(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(z(s)&&s instanceof rt){const r=s.originalError;if([400,404].includes(r==null?void 0:r.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&r.push(i);const l=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",a=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});a!==""&&r.push(a);let d=r.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${s}${d}`)}}}remove(e){return J(this,void 0,void 0,function*(){try{return{data:yield Kt(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(z(t))return{data:null,error:t};throw t}})}list(e,t,s){return J(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},nr),t),{prefix:e||""});return{data:yield oe(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(z(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const ar="2.7.1",lr={"X-Client-Info":`storage-js/${ar}`};var me=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(c){try{d(s.next(c))}catch(h){o(h)}}function a(c){try{d(s.throw(c))}catch(h){o(h)}}function d(c){c.done?i(c.value):r(c.value).then(l,a)}d((s=s.apply(n,e||[])).next())})};class cr{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},lr),t),this.fetch=Jt(s)}listBuckets(){return me(this,void 0,void 0,function*(){try{return{data:yield qe(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(z(e))return{data:null,error:e};throw e}})}getBucket(e){return me(this,void 0,void 0,function*(){try{return{data:yield qe(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(z(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return me(this,void 0,void 0,function*(){try{return{data:yield oe(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(z(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return me(this,void 0,void 0,function*(){try{return{data:yield rr(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(z(s))return{data:null,error:s};throw s}})}emptyBucket(e){return me(this,void 0,void 0,function*(){try{return{data:yield oe(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(z(t))return{data:null,error:t};throw t}})}deleteBucket(e){return me(this,void 0,void 0,function*(){try{return{data:yield Kt(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(z(t))return{data:null,error:t};throw t}})}}class dr extends cr{constructor(e,t={},s){super(e,t,s)}from(e){return new or(this.url,this.headers,e,this.fetch)}}const hr="2.49.4";let Ae="";typeof Deno<"u"?Ae="deno":typeof document<"u"?Ae="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ae="react-native":Ae="node";const ur={"X-Client-Info":`supabase-js-${Ae}/${hr}`},fr={headers:ur},pr={schema:"public"},gr={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},mr={};var yr=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(c){try{d(s.next(c))}catch(h){o(h)}}function a(c){try{d(s.throw(c))}catch(h){o(h)}}function d(c){c.done?i(c.value):r(c.value).then(l,a)}d((s=s.apply(n,e||[])).next())})};const vr=n=>{let e;return n?e=n:typeof fetch>"u"?e=Ot:e=fetch,(...t)=>e(...t)},wr=()=>typeof Headers>"u"?Lt:Headers,br=(n,e,t)=>{const s=vr(t),r=wr();return(i,o)=>yr(void 0,void 0,void 0,function*(){var l;const a=(l=yield e())!==null&&l!==void 0?l:n;let d=new r(o==null?void 0:o.headers);return d.has("apikey")||d.set("apikey",n),d.has("Authorization")||d.set("Authorization",`Bearer ${a}`),s(i,Object.assign(Object.assign({},o),{headers:d}))})};var _r=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(c){try{d(s.next(c))}catch(h){o(h)}}function a(c){try{d(s.throw(c))}catch(h){o(h)}}function d(c){c.done?i(c.value):r(c.value).then(l,a)}d((s=s.apply(n,e||[])).next())})};function xr(n){return n.replace(/\/$/,"")}function kr(n,e){const{db:t,auth:s,realtime:r,global:i}=n,{db:o,auth:l,realtime:a,global:d}=e,c={db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},l),s),realtime:Object.assign(Object.assign({},a),r),global:Object.assign(Object.assign({},d),i),accessToken:()=>_r(this,void 0,void 0,function*(){return""})};return n.accessToken?c.accessToken=n.accessToken:delete c.accessToken,c}const Vt="2.69.1",we=30*1e3,nt=3,Ge=nt*we,Sr="http://localhost:9999",Tr="supabase.auth.token",Er={"X-Client-Info":`gotrue-js/${Vt}`},ot="X-Supabase-Api-Version",Gt={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},$r=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Ar=6e5;class ft extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function D(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Dr extends ft{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function Cr(n){return D(n)&&n.name==="AuthApiError"}class Qt extends ft{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class le extends ft{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class ie extends le{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Rr(n){return D(n)&&n.name==="AuthSessionMissingError"}class Qe extends le{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Pe extends le{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Me extends le{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Or(n){return D(n)&&n.name==="AuthImplicitGrantRedirectError"}class bt extends le{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class at extends le{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Xe(n){return D(n)&&n.name==="AuthRetryableFetchError"}class _t extends le{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Ce extends le{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const xt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),kt=` 	
\r=`.split(""),Lr=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<kt.length;e+=1)n[kt[e].charCodeAt(0)]=-2;for(let e=0;e<xt.length;e+=1)n[xt[e].charCodeAt(0)]=e;return n})();function Xt(n,e,t){const s=Lr[n];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function St(n){const e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},i=o=>{Pr(o,s,t)};for(let o=0;o<n.length;o+=1)Xt(n.charCodeAt(o),r,i);return e.join("")}function jr(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function Ir(n,e){for(let t=0;t<n.length;t+=1){let s=n.charCodeAt(t);if(s>55295&&s<=56319){const r=(s-55296)*1024&65535;s=(n.charCodeAt(t+1)-56320&65535|r)+65536,t+=1}jr(s,e)}}function Pr(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let s=1;s<6;s+=1)if(!(n>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Mr(n){const e=[],t={queue:0,queuedBits:0},s=r=>{e.push(r)};for(let r=0;r<n.length;r+=1)Xt(n.charCodeAt(r),t,s);return new Uint8Array(e)}function Ur(n){const e=[];return Ir(n,t=>e.push(t)),new Uint8Array(e)}function Br(n){return Math.round(Date.now()/1e3)+n}function qr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const ee=()=>typeof window<"u"&&typeof document<"u",he={tested:!1,writable:!1},Re=()=>{if(!ee())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(he.tested)return he.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),he.tested=!0,he.writable=!0}catch{he.tested=!0,he.writable=!1}return he.writable};function Fr(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((r,i)=>{e[i]=r})}catch{}return t.searchParams.forEach((s,r)=>{e[r]=s}),e}const Zt=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>_e(async()=>{const{default:s}=await Promise.resolve().then(()=>ke);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Nr=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",es=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Ue=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Be=async(n,e)=>{await n.removeItem(e)};class Je{constructor(){this.promise=new Je.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Je.promiseConstructor=Promise;function Ze(n){const e=n.split(".");if(e.length!==3)throw new Ce("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!$r.test(e[s]))throw new Ce("JWT not in base64url format");return{header:JSON.parse(St(e[0])),payload:JSON.parse(St(e[1])),signature:Mr(e[2]),raw:{header:e[0],payload:e[1]}}}async function zr(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function Hr(n,e){return new Promise((s,r)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await n(i);if(!e(i,null,o)){s(o);return}}catch(o){if(!e(i,o)){r(o);return}}})()})}function Wr(n){return("0"+n.toString(16)).substr(-2)}function Yr(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let r="";for(let i=0;i<56;i++)r+=t.charAt(Math.floor(Math.random()*s));return r}return crypto.getRandomValues(e),Array.from(e,Wr).join("")}async function Jr(n){const t=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map(i=>String.fromCharCode(i)).join("")}async function Kr(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await Jr(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ye(n,e,t=!1){const s=Yr();let r=s;t&&(r+="/PASSWORD_RECOVERY"),await es(n,`${e}-code-verifier`,r);const i=await Kr(s);return[i,s===i?"plain":"s256"]}const Vr=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Gr(n){const e=n.headers.get(ot);if(!e||!e.match(Vr))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Qr(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function Xr(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var Zr=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};const ue=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),ei=[502,503,504];async function Tt(n){var e;if(!Nr(n))throw new at(ue(n),0);if(ei.includes(n.status))throw new at(ue(n),n.status);let t;try{t=await n.json()}catch(i){throw new Qt(ue(i),i)}let s;const r=Gr(n);if(r&&r.getTime()>=Gt["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new _t(ue(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new ie}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new _t(ue(t),n.status,t.weak_password.reasons);throw new Dr(ue(t),n.status||500,s)}const ti=(n,e,t,s)=>{const r={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),r.body=JSON.stringify(s),Object.assign(Object.assign({},r),t))};async function L(n,e,t,s){var r;const i=Object.assign({},s==null?void 0:s.headers);i[ot]||(i[ot]=Gt["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const o=(r=s==null?void 0:s.query)!==null&&r!==void 0?r:{};s!=null&&s.redirectTo&&(o.redirect_to=s.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",a=await si(n,e,t+l,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(a):{data:Object.assign({},a),error:null}}async function si(n,e,t,s,r,i){const o=ti(e,s,r,i);let l;try{l=await n(t,Object.assign({},o))}catch(a){throw console.error(a),new at(ue(a),0)}if(l.ok||await Tt(l),s!=null&&s.noResolveJson)return l;try{return await l.json()}catch(a){await Tt(a)}}function ne(n){var e;let t=null;oi(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=Br(n.expires_in)));const s=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:s},error:null}}function Et(n){const e=ne(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=n.weak_password),e}function ae(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function ri(n){return{data:n,error:null}}function ii(n){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:r,verification_type:i}=n,o=Zr(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:s,redirect_to:r,verification_type:i},a=Object.assign({},o);return{data:{properties:l,user:a},error:null}}function ni(n){return n}function oi(n){return n.access_token&&n.refresh_token&&n.expires_in}var ai=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class li{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Zt(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await L(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(D(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await L(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ae})}catch(s){if(D(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=ai(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=s==null?void 0:s.newEmail,delete r.newEmail),await L(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:ii,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(D(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await L(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ae})}catch(t){if(D(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,r,i,o,l,a;try{const d={nextPage:null,lastPage:0,total:0},c=await L(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(r=e==null?void 0:e.perPage)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:""},xform:ni});if(c.error)throw c.error;const h=await c.json(),u=(o=c.headers.get("x-total-count"))!==null&&o!==void 0?o:0,g=(a=(l=c.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&a!==void 0?a:[];return g.length>0&&(g.forEach(y=>{const f=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),p=JSON.parse(y.split(";")[1].split("=")[1]);d[`${p}Page`]=f}),d.total=parseInt(u)),{data:Object.assign(Object.assign({},h),d),error:null}}catch(d){if(D(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){try{return await L(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ae})}catch(t){if(D(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await L(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ae})}catch(s){if(D(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await L(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ae})}catch(s){if(D(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await L(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:t,error:s}}catch(t){if(D(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await L(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(D(t))return{data:null,error:t};throw t}}}const ci={getItem:n=>Re()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{Re()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{Re()&&globalThis.localStorage.removeItem(n)}};function $t(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function di(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ve={debug:!!(globalThis&&Re()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class ts extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class hi extends ts{}async function ui(n,e,t){ve.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),ve.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async r=>{if(r){ve.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,r.name);try{return await t()}finally{ve.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,r.name)}}else{if(e===0)throw ve.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new hi(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(ve.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}di();const fi={url:Sr,storageKey:Tr,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Er,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function At(n,e,t){return await t()}class Oe{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Oe.nextInstanceID,Oe.nextInstanceID+=1,this.instanceID>0&&ee()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},fi),e);if(this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new li({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Zt(r.fetch),this.lock=r.lock||At,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:ee()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=ui:this.lock=At,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?r.storage?this.storage=r.storage:Re()?this.storage=ci:(this.memoryStorage={},this.storage=$t(this.memoryStorage)):(this.memoryStorage={},this.storage=$t(this.memoryStorage)),ee()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Vt}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Fr(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),ee()&&this.detectSessionInUrl&&s!=="none"){const{data:r,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Or(i)){const a=(e=i.details)===null||e===void 0?void 0:e.code;if(a==="identity_already_exists"||a==="identity_not_found"||a==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:l}=r;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return D(t)?{error:t}:{error:new Qt("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,r;try{const i=await L(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.captchaToken}},xform:ne}),{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const a=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:d,session:a},error:null}}catch(i){if(D(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,r;try{let i;if("email"in e){const{email:c,password:h,options:u}=e;let g=null,y=null;this.flowType==="pkce"&&([g,y]=await ye(this.storage,this.storageKey)),i=await L(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:u==null?void 0:u.emailRedirectTo,body:{email:c,password:h,data:(t=u==null?void 0:u.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},code_challenge:g,code_challenge_method:y},xform:ne})}else if("phone"in e){const{phone:c,password:h,options:u}=e;i=await L(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:c,password:h,data:(s=u==null?void 0:u.data)!==null&&s!==void 0?s:{},channel:(r=u==null?void 0:u.channel)!==null&&r!==void 0?r:"sms",gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:ne})}else throw new Pe("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const a=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:d,session:a},error:null}}catch(i){if(D(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:l}=e;t=await L(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Et})}else if("phone"in e){const{phone:i,password:o,options:l}=e;t=await L(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Et})}else throw new Pe("You must provide either an email or phone number and a password");const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Qe}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r})}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,r,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(r=e.options)===null||r===void 0?void 0:r.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Ue(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(t??"").split("/");try{const{data:i,error:o}=await L(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:ne});if(await Be(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Qe}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:r??null}),error:o})}catch(i){if(D(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:r,access_token:i,nonce:o}=e,l=await L(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:ne}),{data:a,error:d}=l;return d?{data:{user:null,session:null},error:d}:!a||!a.session||!a.user?{data:{user:null,session:null},error:new Qe}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:d})}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,r,i,o;try{if("email"in e){const{email:l,options:a}=e;let d=null,c=null;this.flowType==="pkce"&&([d,c]=await ye(this.storage,this.storageKey));const{error:h}=await L(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=a==null?void 0:a.data)!==null&&t!==void 0?t:{},create_user:(s=a==null?void 0:a.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken},code_challenge:d,code_challenge_method:c},redirectTo:a==null?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:l,options:a}=e,{data:d,error:c}=await L(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(r=a==null?void 0:a.data)!==null&&r!==void 0?r:{},create_user:(i=a==null?void 0:a.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken},channel:(o=a==null?void 0:a.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:c}}throw new Pe("You must provide either an email or phone number.")}catch(l){if(D(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var t,s;try{let r,i;"options"in e&&(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:l}=await L(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:ne});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const a=o.session,d=o.user;return a!=null&&a.access_token&&(await this._saveSession(a),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:d,session:a},error:null}}catch(r){if(D(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var t,s,r;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await ye(this.storage,this.storageKey)),await L(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((r=e==null?void 0:e.options)===null||r===void 0)&&r.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:ri})}catch(i){if(D(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new ie;const{error:r}=await L(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(D(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:i}=e,{error:o}=await L(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:s,type:r,options:i}=e,{data:o,error:l}=await L(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new Pe("You must provide either an email or phone number and a type")}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch{}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const r=[...this.pendingInLock];await Promise.all(r),this.pendingInLock.splice(0,r.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ue(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Ge:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(a,d,c)=>(!o&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(a,d,c))})}return{data:{session:e},error:null}}const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await L(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ae}):await this._useSession(async t=>{var s,r,i;const{data:o,error:l}=t;if(l)throw l;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ie}:await L(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0,xform:ae})})}catch(t){if(D(t))return Rr(t)&&(await this._removeSession(),await Be(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:r,error:i}=s;if(i)throw i;if(!r.session)throw new ie;const o=r.session;let l=null,a=null;this.flowType==="pkce"&&e.email!=null&&([l,a]=await ye(this.storage,this.storageKey));const{data:d,error:c}=await L(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:a}),jwt:o.access_token,xform:ae});if(c)throw c;return o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(s){if(D(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ie;const t=Date.now()/1e3;let s=t,r=!0,i=null;const{payload:o}=Ze(e.access_token);if(o.exp&&(s=o.exp,r=s<=t),r){const{session:l,error:a}=await this._callRefreshToken(e.refresh_token);if(a)return{data:{user:null,session:null},error:a};if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:a}=await this._getUser(e.access_token);if(a)throw a;i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(D(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:l}=t;if(l)throw l;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new ie;const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!ee())throw new Me("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Me(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new bt("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Me("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new bt("No code detected.");const{data:m,error:R}=await this._exchangeCodeForSession(e.code);if(R)throw R;const x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:m.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:i,refresh_token:o,expires_in:l,expires_at:a,token_type:d}=e;if(!i||!l||!o||!d)throw new Me("No session defined in URL");const c=Math.round(Date.now()/1e3),h=parseInt(l);let u=c+h;a&&(u=parseInt(a));const g=u-c;g*1e3<=we&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${h}s`);const y=u-h;c-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,u,c):c-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,u,c);const{data:f,error:p}=await this._getUser(i);if(p)throw p;const T={provider_token:s,provider_refresh_token:r,access_token:i,expires_in:h,expires_at:u,refresh_token:o,token_type:d,user:f.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:T,redirectType:e.type},error:null}}catch(s){if(D(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ue(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:r,error:i}=t;if(i)return{error:i};const o=(s=r.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(Cr(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await Be(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=qr(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,r;try{const{data:{session:i},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,r=null;this.flowType==="pkce"&&([s,r]=await ye(this.storage,this.storageKey,!0));try{return await L(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(D(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(D(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:r}=await this._useSession(async i=>{var o,l,a,d,c;const{data:h,error:u}=i;if(u)throw u;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:!0});return await L(this.fetch,"GET",g,{headers:this.headers,jwt:(c=(d=h.session)===null||d===void 0?void 0:d.access_token)!==null&&c!==void 0?c:void 0})});if(r)throw r;return ee()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(D(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,r;const{data:i,error:o}=t;if(o)throw o;return await L(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(r=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&r!==void 0?r:void 0})})}catch(t){if(D(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await Hr(async r=>(r>0&&await zr(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await L(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ne})),(r,i)=>{const o=200*Math.pow(2,r);return i&&Xe(i)&&Date.now()+o-s<we})}catch(s){if(this._debug(t,"error",s),D(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),ee()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Ue(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const r=((e=s.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Ge;if(this._debug(t,`session has${r?"":" not"} expired with margin of ${Ge}s`),r){if(this.autoRefreshToken&&s.refresh_token){const{error:i}=await this._callRefreshToken(s.refresh_token);i&&(console.error(i),Xe(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new ie;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Je;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new ie;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={session:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(r,"error",i),D(i)){const o={session:null,error:i};return Xe(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(a){i.push(a)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await es(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Be(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ee()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),we);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((s.expires_at*1e3-e)/we);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${we}ms, refresh threshold is ${nt} ticks`),r<=nt&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof ts)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ee()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const r=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,o]=await ye(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});r.push(l.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);r.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await L(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(D(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,r;const{data:i,error:o}=t;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:a,error:d}=await L(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return d?{data:null,error:d}:(e.factorType==="totp"&&(!((r=a==null?void 0:a.totp)===null||r===void 0)&&r.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(t){if(D(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:l}=await L(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})})}catch(t){if(D(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await L(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(D(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],r=s.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=s.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:s,totp:r,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:r},error:i}=e;if(i)return{data:null,error:i};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Ze(r.access_token);let l=null;o.aal&&(l=o.aal);let a=l;((s=(t=r.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(a="aal2");const c=o.amr||[];return{data:{currentLevel:l,nextLevel:a,currentAuthenticationMethods:c},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(o=>o.kid===e);if(s||(s=this.jwks.keys.find(o=>o.kid===e),s&&this.jwks_cached_at+Ar>Date.now()))return s;const{data:r,error:i}=await L(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!r.keys||r.keys.length===0)throw new Ce("JWKS is empty");if(this.jwks=r,this.jwks_cached_at=Date.now(),s=r.keys.find(o=>o.kid===e),!s)throw new Ce("No matching signing key found in JWKS");return s}async getClaims(e,t={keys:[]}){try{let s=e;if(!s){const{data:g,error:y}=await this.getSession();if(y||!g.session)return{data:null,error:y};s=g.session.access_token}const{header:r,payload:i,signature:o,raw:{header:l,payload:a}}=Ze(s);if(Qr(i.exp),!r.kid||r.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:g}=await this.getUser(s);if(g)throw g;return{data:{claims:i,header:r,signature:o},error:null}}const d=Xr(r.alg),c=await this.fetchJwk(r.kid,t),h=await crypto.subtle.importKey("jwk",c,d,!0,["verify"]);if(!await crypto.subtle.verify(d,h,o,Ur(`${l}.${a}`)))throw new Ce("Invalid JWT signature");return{data:{claims:i,header:r,signature:o},error:null}}catch(s){if(D(s))return{data:null,error:s};throw s}}}Oe.nextInstanceID=0;const pi=Oe;class gi extends pi{constructor(e){super(e)}}var mi=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(c){try{d(s.next(c))}catch(h){o(h)}}function a(c){try{d(s.throw(c))}catch(h){o(h)}}function d(c){c.done?i(c.value):r(c.value).then(l,a)}d((s=s.apply(n,e||[])).next())})};class yi{constructor(e,t,s){var r,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const l=xr(e);this.realtimeUrl=`${l}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${l}/auth/v1`,this.storageUrl=`${l}/storage/v1`,this.functionsUrl=`${l}/functions/v1`;const a=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,d={db:pr,realtime:mr,auth:Object.assign(Object.assign({},gr),{storageKey:a}),global:fr},c=kr(s??{},d);this.storageKey=(r=c.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(i=c.global.headers)!==null&&i!==void 0?i:{},c.accessToken?(this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(h,u)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(u)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=c.auth)!==null&&o!==void 0?o:{},this.headers,c.global.fetch),this.fetch=br(t,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.rest=new Is(`${l}/rest/v1`,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),c.accessToken||this._listenForAuthEvents()}get functions(){return new ds(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new dr(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return mi(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:i,flowType:o,lock:l,debug:a},d,c){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new gi({url:this.authUrl,headers:Object.assign(Object.assign({},h),d),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:o,lock:l,debug:a,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Gs(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const vi=(n,e,t)=>new yi(n,e,t),wi="https://mzlxlrqpxuahjtnojvdq.supabase.co",bi="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16bHhscnFweHVhaGp0bm9qdmRxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTM5MTYsImV4cCI6MjA2MDk4OTkxNn0.GRiL2zYSBMhR3UuCaLmT_OHg5MKJmUr_AUjPoUUO6j4",B=vi(wi,bi),Z={projects:"projects",samples:"samples",xrd_analyses:"xrd_analyses",chemical_analyses:"chemical_analyses",reports:"reports",events:"events"},Dt={async getProjects(){console.log("Getting projects");const{data:n,error:e}=await B.from(Z.projects).select("*").order("created_at",{ascending:!1});if(e)throw e;return{data:n,error:null}},async addProject(n){console.log("Adding project",n);const{data:e,error:t}=await B.from(Z.projects).insert(n).select().single();if(t)throw t;return{data:e,error:null}},async getSamples(n){console.log("Getting samples for project",n);const{data:e,error:t}=await B.from(Z.samples).select("*").eq("project_id",n).order("created_at",{ascending:!1});if(t)throw t;return{data:e,error:null}},async addSample(n){console.log("Adding sample",n);const{data:e,error:t}=await B.from(Z.samples).insert(n).select().single();if(t)throw t;return{data:e,error:null}},async getEvents(){console.log("Getting events");const{data:n,error:e}=await B.from(Z.events).select("*").order("date",{ascending:!0});if(e)throw e;return{data:n,error:null}},async addEvent(n){console.log("Adding event",n);const{data:e,error:t}=await B.from(Z.events).insert(n).select().single();if(t)throw t;return{data:e,error:null}},async deleteEvent(n){console.log("Deleting event",n);const{error:e}=await B.from(Z.events).delete().eq("id",n);if(e)throw e;return{data:null,error:null}},async getReports(n){console.log("Getting reports for project",n);const{data:e,error:t}=await B.from(Z.reports).select("*").eq("project_id",n).order("created_at",{ascending:!1});if(t)throw t;return{data:e,error:null}},async getAnalyses(n,e){console.log(`Getting ${e} analyses for sample`,n);const t=e==="xrd"?Z.xrd_analyses:Z.chemical_analyses,{data:s,error:r}=await B.from(t).select("*").eq("sample_id",n).order("created_at",{ascending:!1});if(r)throw r;return{data:s,error:null}}};class _i{constructor(e){this.container=e,this.currentDate=new Date,this.selectedDate=new Date,this.events=[]}async init(){try{await this.loadEvents(),this.render(),this.attachEventListeners()}catch(e){console.error("Error initializing calendar:",e),this.showError("Failed to initialize calendar")}}async loadEvents(){try{const{data:e,error:t}=await Dt.getEvents();if(t)throw t;this.events=e||[]}catch(e){throw console.error("Error loading events:",e),e}}render(){this.container.innerHTML=`
      <div class="calendar-container">
        <div class="calendar-header">
          <button class="prev-month">&lt;</button>
          <h2>${this.getMonthYear()}</h2>
          <button class="next-month">&gt;</button>
        </div>
        <div class="calendar-grid">
          ${this.generateCalendarGrid()}
        </div>
        <div class="calendar-events">
          <h3>Events for ${this.formatDate(this.selectedDate)}</h3>
          <div class="events-list">
            ${this.renderEvents()}
          </div>
          <button class="add-event-btn">Add Event</button>
        </div>
      </div>
    `}generateCalendarGrid(){const e=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()+1,0).getDate(),t=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth(),1).getDay();let s=this.generateWeekdayHeaders(),r=1,i="";for(let o=0;o<t;o++)i+='<div class="calendar-cell empty"></div>';for(;r<=e;){const o=this.isToday(r),l=this.isSelectedDate(r),a=this.hasEventsOnDate(r);i+=`
        <div class="calendar-cell ${o?"today":""} ${l?"selected":""} ${a?"has-events":""}"
             data-date="${this.formatDateForAttribute(r)}">
          ${r}
        </div>
      `,r++}return s+i}generateWeekdayHeaders(){return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>`<div class="weekday-header">${t}</div>`).join("")}getMonthYear(){return this.currentDate.toLocaleString("default",{month:"long",year:"numeric"})}formatDate(e){return e.toLocaleDateString("default",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}formatDateForAttribute(e){return`${this.currentDate.getFullYear()}-${String(this.currentDate.getMonth()+1).padStart(2,"0")}-${String(e).padStart(2,"0")}`}isToday(e){const t=new Date;return e===t.getDate()&&this.currentDate.getMonth()===t.getMonth()&&this.currentDate.getFullYear()===t.getFullYear()}isSelectedDate(e){return e===this.selectedDate.getDate()&&this.currentDate.getMonth()===this.selectedDate.getMonth()&&this.currentDate.getFullYear()===this.selectedDate.getFullYear()}hasEventsOnDate(e){const t=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth(),e);return this.events.some(s=>{const r=new Date(s.date);return r.getDate()===t.getDate()&&r.getMonth()===t.getMonth()&&r.getFullYear()===t.getFullYear()})}renderEvents(){const e=this.events.filter(t=>{const s=new Date(t.date);return s.getDate()===this.selectedDate.getDate()&&s.getMonth()===this.selectedDate.getMonth()&&s.getFullYear()===this.selectedDate.getFullYear()});return e.length===0?"<p>No events scheduled for this date.</p>":e.map(t=>`
        <div class="event-item">
          <h4>${t.title}</h4>
          <p>${t.time}</p>
          <p>${t.description}</p>
        </div>
      `).join("")}addEvent(e){this.events.push(e)}nextMonth(){this.currentDate.setMonth(this.currentDate.getMonth()+1)}previousMonth(){this.currentDate.setMonth(this.currentDate.getMonth()-1)}selectDate(e){this.selectedDate=new Date(e)}attachEventListeners(){const e=this.container.querySelector(".prev-month");e&&e.addEventListener("click",()=>{this.previousMonth(),this.render(),this.attachEventListeners()});const t=this.container.querySelector(".next-month");t&&t.addEventListener("click",()=>{this.nextMonth(),this.render(),this.attachEventListeners()}),this.container.querySelectorAll(".calendar-cell:not(.empty)").forEach(i=>{i.addEventListener("click",()=>{const o=i.getAttribute("data-date");o&&(this.selectDate(o),this.render(),this.attachEventListeners())})});const r=this.container.querySelector(".add-event-btn");r&&r.addEventListener("click",()=>{this.showEventModal()})}showEventModal(){const e=document.createElement("div");e.className="modal",e.innerHTML=`
      <div class="modal-content">
        <h3>Add Event</h3>
        <form id="add-event-form">
          <input type="text" placeholder="Event Title" required>
          <input type="time" required>
          <textarea placeholder="Event Description" rows="3"></textarea>
          <button type="submit">Save Event</button>
          <button type="button" class="close-modal">Cancel</button>
        </form>
      </div>
    `,document.body.appendChild(e);const t=e.querySelector("form"),s=e.querySelector(".close-modal");t.addEventListener("submit",async r=>{r.preventDefault();const[i,o,l]=[t.querySelector('input[type="text"]').value,t.querySelector('input[type="time"]').value,t.querySelector("textarea").value];try{await Dt.addEvent({title:i,time:o,description:l,date:this.selectedDate.toISOString().split("T")[0]}),await this.loadEvents(),this.render(),this.attachEventListeners(),document.body.removeChild(e)}catch(a){console.error("Error adding event:",a),this.showError("Failed to add event")}}),s.addEventListener("click",()=>{document.body.removeChild(e)})}showError(e){const t=document.createElement("div");t.className="error-message",t.textContent=e,this.container.prepend(t),setTimeout(()=>t.remove(),3e3)}}var ss={exports:{}};(function(n,e){(function(t,s){n.exports=s()})(W,function(){var t=1e3,s=6e4,r=36e5,i="millisecond",o="second",l="minute",a="hour",d="day",c="week",h="month",u="quarter",g="year",y="date",f="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,T=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,m={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(S){var b=["th","st","nd","rd"],v=S%100;return"["+S+(b[(v-20)%10]||b[v]||b[0])+"]"}},R=function(S,b,v){var k=String(S);return!k||k.length>=b?S:""+Array(b+1-k.length).join(v)+S},x={s:R,z:function(S){var b=-S.utcOffset(),v=Math.abs(b),k=Math.floor(v/60),w=v%60;return(b<=0?"+":"-")+R(k,2,"0")+":"+R(w,2,"0")},m:function S(b,v){if(b.date()<v.date())return-S(v,b);var k=12*(v.year()-b.year())+(v.month()-b.month()),w=b.clone().add(k,h),$=v-w<0,A=b.clone().add(k+($?-1:1),h);return+(-(k+(v-w)/($?w-A:A-w))||0)},a:function(S){return S<0?Math.ceil(S)||0:Math.floor(S)},p:function(S){return{M:h,y:g,w:c,d,D:y,h:a,m:l,s:o,ms:i,Q:u}[S]||String(S||"").toLowerCase().replace(/s$/,"")},u:function(S){return S===void 0}},_="en",E={};E[_]=m;var j="$isDayjsObject",q=function(S){return S instanceof V||!(!S||!S[j])},U=function S(b,v,k){var w;if(!b)return _;if(typeof b=="string"){var $=b.toLowerCase();E[$]&&(w=$),v&&(E[$]=v,w=$);var A=b.split("-");if(!w&&A.length>1)return S(A[0])}else{var I=b.name;E[I]=b,w=I}return!k&&w&&(_=w),w||!k&&_},O=function(S,b){if(q(S))return S.clone();var v=typeof b=="object"?b:{};return v.date=S,v.args=arguments,new V(v)},C=x;C.l=U,C.i=q,C.w=function(S,b){return O(S,{locale:b.$L,utc:b.$u,x:b.$x,$offset:b.$offset})};var V=function(){function S(v){this.$L=U(v.locale,null,!0),this.parse(v),this.$x=this.$x||v.x||{},this[j]=!0}var b=S.prototype;return b.parse=function(v){this.$d=function(k){var w=k.date,$=k.utc;if(w===null)return new Date(NaN);if(C.u(w))return new Date;if(w instanceof Date)return new Date(w);if(typeof w=="string"&&!/Z$/i.test(w)){var A=w.match(p);if(A){var I=A[2]-1||0,F=(A[7]||"0").substring(0,3);return $?new Date(Date.UTC(A[1],I,A[3]||1,A[4]||0,A[5]||0,A[6]||0,F)):new Date(A[1],I,A[3]||1,A[4]||0,A[5]||0,A[6]||0,F)}}return new Date(w)}(v),this.init()},b.init=function(){var v=this.$d;this.$y=v.getFullYear(),this.$M=v.getMonth(),this.$D=v.getDate(),this.$W=v.getDay(),this.$H=v.getHours(),this.$m=v.getMinutes(),this.$s=v.getSeconds(),this.$ms=v.getMilliseconds()},b.$utils=function(){return C},b.isValid=function(){return this.$d.toString()!==f},b.isSame=function(v,k){var w=O(v);return this.startOf(k)<=w&&w<=this.endOf(k)},b.isAfter=function(v,k){return O(v)<this.startOf(k)},b.isBefore=function(v,k){return this.endOf(k)<O(v)},b.$g=function(v,k,w){return C.u(v)?this[k]:this.set(w,v)},b.unix=function(){return Math.floor(this.valueOf()/1e3)},b.valueOf=function(){return this.$d.getTime()},b.startOf=function(v,k){var w=this,$=!!C.u(k)||k,A=C.p(v),I=function(de,Y){var re=C.w(w.$u?Date.UTC(w.$y,Y,de):new Date(w.$y,Y,de),w);return $?re:re.endOf(d)},F=function(de,Y){return C.w(w.toDate()[de].apply(w.toDate("s"),($?[0,0,0,0]:[23,59,59,999]).slice(Y)),w)},N=this.$W,H=this.$M,Q=this.$D,ge="set"+(this.$u?"UTC":"");switch(A){case g:return $?I(1,0):I(31,11);case h:return $?I(1,H):I(0,H+1);case c:var ce=this.$locale().weekStart||0,Te=(N<ce?N+7:N)-ce;return I($?Q-Te:Q+(6-Te),H);case d:case y:return F(ge+"Hours",0);case a:return F(ge+"Minutes",1);case l:return F(ge+"Seconds",2);case o:return F(ge+"Milliseconds",3);default:return this.clone()}},b.endOf=function(v){return this.startOf(v,!1)},b.$set=function(v,k){var w,$=C.p(v),A="set"+(this.$u?"UTC":""),I=(w={},w[d]=A+"Date",w[y]=A+"Date",w[h]=A+"Month",w[g]=A+"FullYear",w[a]=A+"Hours",w[l]=A+"Minutes",w[o]=A+"Seconds",w[i]=A+"Milliseconds",w)[$],F=$===d?this.$D+(k-this.$W):k;if($===h||$===g){var N=this.clone().set(y,1);N.$d[I](F),N.init(),this.$d=N.set(y,Math.min(this.$D,N.daysInMonth())).$d}else I&&this.$d[I](F);return this.init(),this},b.set=function(v,k){return this.clone().$set(v,k)},b.get=function(v){return this[C.p(v)]()},b.add=function(v,k){var w,$=this;v=Number(v);var A=C.p(k),I=function(H){var Q=O($);return C.w(Q.date(Q.date()+Math.round(H*v)),$)};if(A===h)return this.set(h,this.$M+v);if(A===g)return this.set(g,this.$y+v);if(A===d)return I(1);if(A===c)return I(7);var F=(w={},w[l]=s,w[a]=r,w[o]=t,w)[A]||1,N=this.$d.getTime()+v*F;return C.w(N,this)},b.subtract=function(v,k){return this.add(-1*v,k)},b.format=function(v){var k=this,w=this.$locale();if(!this.isValid())return w.invalidDate||f;var $=v||"YYYY-MM-DDTHH:mm:ssZ",A=C.z(this),I=this.$H,F=this.$m,N=this.$M,H=w.weekdays,Q=w.months,ge=w.meridiem,ce=function(Y,re,Ee,Ie){return Y&&(Y[re]||Y(k,$))||Ee[re].slice(0,Ie)},Te=function(Y){return C.s(I%12||12,Y,"0")},de=ge||function(Y,re,Ee){var Ie=Y<12?"AM":"PM";return Ee?Ie.toLowerCase():Ie};return $.replace(T,function(Y,re){return re||function(Ee){switch(Ee){case"YY":return String(k.$y).slice(-2);case"YYYY":return C.s(k.$y,4,"0");case"M":return N+1;case"MM":return C.s(N+1,2,"0");case"MMM":return ce(w.monthsShort,N,Q,3);case"MMMM":return ce(Q,N);case"D":return k.$D;case"DD":return C.s(k.$D,2,"0");case"d":return String(k.$W);case"dd":return ce(w.weekdaysMin,k.$W,H,2);case"ddd":return ce(w.weekdaysShort,k.$W,H,3);case"dddd":return H[k.$W];case"H":return String(I);case"HH":return C.s(I,2,"0");case"h":return Te(1);case"hh":return Te(2);case"a":return de(I,F,!0);case"A":return de(I,F,!1);case"m":return String(F);case"mm":return C.s(F,2,"0");case"s":return String(k.$s);case"ss":return C.s(k.$s,2,"0");case"SSS":return C.s(k.$ms,3,"0");case"Z":return A}return null}(Y)||A.replace(":","")})},b.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},b.diff=function(v,k,w){var $,A=this,I=C.p(k),F=O(v),N=(F.utcOffset()-this.utcOffset())*s,H=this-F,Q=function(){return C.m(A,F)};switch(I){case g:$=Q()/12;break;case h:$=Q();break;case u:$=Q()/3;break;case c:$=(H-N)/6048e5;break;case d:$=(H-N)/864e5;break;case a:$=H/r;break;case l:$=H/s;break;case o:$=H/t;break;default:$=H}return w?$:C.a($)},b.daysInMonth=function(){return this.endOf(h).$D},b.$locale=function(){return E[this.$L]},b.locale=function(v,k){if(!v)return this.$L;var w=this.clone(),$=U(v,k,!0);return $&&(w.$L=$),w},b.clone=function(){return C.w(this.$d,this)},b.toDate=function(){return new Date(this.valueOf())},b.toJSON=function(){return this.isValid()?this.toISOString():null},b.toISOString=function(){return this.$d.toISOString()},b.toString=function(){return this.$d.toUTCString()},S}(),pt=V.prototype;return O.prototype=pt,[["$ms",i],["$s",o],["$m",l],["$H",a],["$W",d],["$M",h],["$y",g],["$D",y]].forEach(function(S){pt[S[1]]=function(b){return this.$g(b,S[0],S[1])}}),O.extend=function(S,b){return S.$i||(S(b,V,O),S.$i=!0),O},O.locale=U,O.isDayjs=q,O.unix=function(S){return O(1e3*S)},O.en=E[_],O.Ls=E,O.p={},O})})(ss);var xi=ss.exports;const se=ct(xi);var rs={exports:{}};(function(n,e){(function(t,s){n.exports=s()})(W,function(){var t="minute",s=/[+-]\d\d(?::?\d\d)?/g,r=/([+-]|\d\d)/g;return function(i,o,l){var a=o.prototype;l.utc=function(f){var p={date:f,utc:!0,args:arguments};return new o(p)},a.utc=function(f){var p=l(this.toDate(),{locale:this.$L,utc:!0});return f?p.add(this.utcOffset(),t):p},a.local=function(){return l(this.toDate(),{locale:this.$L,utc:!1})};var d=a.parse;a.parse=function(f){f.utc&&(this.$u=!0),this.$utils().u(f.$offset)||(this.$offset=f.$offset),d.call(this,f)};var c=a.init;a.init=function(){if(this.$u){var f=this.$d;this.$y=f.getUTCFullYear(),this.$M=f.getUTCMonth(),this.$D=f.getUTCDate(),this.$W=f.getUTCDay(),this.$H=f.getUTCHours(),this.$m=f.getUTCMinutes(),this.$s=f.getUTCSeconds(),this.$ms=f.getUTCMilliseconds()}else c.call(this)};var h=a.utcOffset;a.utcOffset=function(f,p){var T=this.$utils().u;if(T(f))return this.$u?0:T(this.$offset)?h.call(this):this.$offset;if(typeof f=="string"&&(f=function(_){_===void 0&&(_="");var E=_.match(s);if(!E)return null;var j=(""+E[0]).match(r)||["-",0,0],q=j[0],U=60*+j[1]+ +j[2];return U===0?0:q==="+"?U:-U}(f),f===null))return this;var m=Math.abs(f)<=16?60*f:f,R=this;if(p)return R.$offset=m,R.$u=f===0,R;if(f!==0){var x=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(R=this.local().add(m+x,t)).$offset=m,R.$x.$localOffset=x}else R=this.utc();return R};var u=a.format;a.format=function(f){var p=f||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return u.call(this,p)},a.valueOf=function(){var f=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*f},a.isUTC=function(){return!!this.$u},a.toISOString=function(){return this.toDate().toISOString()},a.toString=function(){return this.toDate().toUTCString()};var g=a.toDate;a.toDate=function(f){return f==="s"&&this.$offset?l(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():g.call(this)};var y=a.diff;a.diff=function(f,p,T){if(f&&this.$u===f.$u)return y.call(this,f,p,T);var m=this.local(),R=l(f).local();return y.call(m,R,p,T)}}})})(rs);var ki=rs.exports;const Si=ct(ki);var is={exports:{}};(function(n,e){(function(t,s){n.exports=s()})(W,function(){var t={year:0,month:1,day:2,hour:3,minute:4,second:5},s={};return function(r,i,o){var l,a=function(u,g,y){y===void 0&&(y={});var f=new Date(u),p=function(T,m){m===void 0&&(m={});var R=m.timeZoneName||"short",x=T+"|"+R,_=s[x];return _||(_=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:T,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:R}),s[x]=_),_}(g,y);return p.formatToParts(f)},d=function(u,g){for(var y=a(u,g),f=[],p=0;p<y.length;p+=1){var T=y[p],m=T.type,R=T.value,x=t[m];x>=0&&(f[x]=parseInt(R,10))}var _=f[3],E=_===24?0:_,j=f[0]+"-"+f[1]+"-"+f[2]+" "+E+":"+f[4]+":"+f[5]+":000",q=+u;return(o.utc(j).valueOf()-(q-=q%1e3))/6e4},c=i.prototype;c.tz=function(u,g){u===void 0&&(u=l);var y,f=this.utcOffset(),p=this.toDate(),T=p.toLocaleString("en-US",{timeZone:u}),m=Math.round((p-new Date(T))/1e3/60),R=15*-Math.round(p.getTimezoneOffset()/15)-m;if(!Number(R))y=this.utcOffset(0,g);else if(y=o(T,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(R,!0),g){var x=y.utcOffset();y=y.add(f-x,"minute")}return y.$x.$timezone=u,y},c.offsetName=function(u){var g=this.$x.$timezone||o.tz.guess(),y=a(this.valueOf(),g,{timeZoneName:u}).find(function(f){return f.type.toLowerCase()==="timezonename"});return y&&y.value};var h=c.startOf;c.startOf=function(u,g){if(!this.$x||!this.$x.$timezone)return h.call(this,u,g);var y=o(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return h.call(y,u,g).tz(this.$x.$timezone,!0)},o.tz=function(u,g,y){var f=y&&g,p=y||g||l,T=d(+o(),p);if(typeof u!="string")return o(u).tz(p);var m=function(E,j,q){var U=E-60*j*1e3,O=d(U,q);if(j===O)return[U,j];var C=d(U-=60*(O-j)*1e3,q);return O===C?[U,O]:[E-60*Math.min(O,C)*1e3,Math.max(O,C)]}(o.utc(u,f).valueOf(),T,p),R=m[0],x=m[1],_=o(R).utcOffset(x);return _.$x.$timezone=p,_},o.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},o.tz.setDefault=function(u){l=u}}})})(is);var Ti=is.exports;const Ei=ct(Ti);se.extend(Si);se.extend(Ei);Intl.DateTimeFormat().resolvedOptions().timeZone;class $i{static async checkDatabaseStructure(){try{console.log("[RosterApi] Checking database structure");const{data:e,error:t}=await B.from("shifts").select("*").limit(1);if(t)throw console.error("[RosterApi] Error querying shifts table:",t),t;return e&&e.length>0?(console.log("[RosterApi] Shifts table structure:",Object.keys(e[0])),console.log("[RosterApi] Sample shift data:",e[0])):console.log("[RosterApi] Shifts table exists but is empty"),!0}catch(e){throw console.error("[RosterApi] Database structure check failed:",e),e}}static async getShifts(e,t){try{console.log("[RosterApi] Raw date range:",{startDate:e.toISOString(),endDate:t.toISOString()});const s=se(e).startOf("day").format("YYYY-MM-DD"),r=se(t).endOf("day").format("YYYY-MM-DD");console.log("[RosterApi] Formatted date range:",{formattedStartDate:s,formattedEndDate:r});const{data:i,error:o}=await B.from("shifts").select("*").limit(1);console.log("[RosterApi] Test query result:",{testShift:i,testError:o});const{data:l,error:a}=await B.from("shifts").select("*").gte("shift_date",s).lte("shift_date",r).order("shift_date",{ascending:!0});if(a)throw console.error("[RosterApi] Error fetching shifts:",a),a;if(console.log("[RosterApi] Raw shifts from database:",l),!l||l.length===0)return console.log("[RosterApi] No shifts found for date range"),[];const d=l.map(c=>{const h={...c,shift_date:se(c.shift_date).format("YYYY-MM-DD")};return console.log("[RosterApi] Processed shift:",h),h});return console.log("[RosterApi] All processed shifts:",d),d}catch(s){throw console.error("[RosterApi] Error in getShifts:",s),s}}static async addShift(e){try{console.log("[RosterApi] Adding new shift:",e);const t={...e,shift_date:se(e.shift_date).format("YYYY-MM-DD"),updated_at:se().format()};delete t.shift_start,delete t.shift_end,console.log("[RosterApi] Formatted shift data:",t);const{data:s,error:r}=await B.from("shifts").insert([t]).select().single();if(r)throw console.error("[RosterApi] Error adding shift:",r),r;return console.log("[RosterApi] Successfully added shift:",s),s}catch(t){throw console.error("[RosterApi] Error in addShift:",t),t}}static async updateShift(e,t){try{console.log("[RosterApi] Updating shift:",e,"with data:",t);const s={...t,updated_at:se().format()};t.shift_date!==void 0?s.shift_date=se(t.shift_date).format("YYYY-MM-DD"):delete s.shift_date,delete s.shift_start,delete s.shift_end,console.log("[RosterApi] Formatted update data:",s);const{data:r,error:i}=await B.from("shifts").update(s).eq("id",e).select().single();if(i)throw console.error("[RosterApi] Error updating shift:",i),i;return console.log("[RosterApi] Successfully updated shift:",r),r}catch(s){throw console.error("[RosterApi] Error in updateShift:",s),s}}static async deleteShift(e){try{console.log("Deleting shift:",e);const{error:t}=await B.from("shifts").delete().eq("id",e);if(t)throw console.error("Error deleting shift:",t),t;return console.log("Successfully deleted shift:",e),!0}catch(t){throw console.error("Error in deleteShift:",t),t}}static async getEmployees(){return[{id:"1",name:"Toti"},{id:"2",name:"Tizi"}]}static async getTimeLogs({startDate:e,endDate:t,workerName:s}){console.log(`[RosterApi] Getting time logs for range: ${e} to ${t}${s?`, worker: ${s}`:""}`);try{let r=B.from("time_logs").select("*, project:project_id(name, description)").gte("log_date",e).lte("log_date",t).order("log_date",{ascending:!0});s&&(r=r.eq("worker_name",s));const{data:i,error:o}=await r;if(o)return console.error("[RosterApi] Error fetching time logs:",o),{data:null,error:o};const l=i.map(a=>{const d={...a,log_date:new Date(a.log_date).toISOString().split("T")[0],hours_worked:a.hours_worked||0,activity_description:a.activity_description||"",project:a.project||{name:"Unknown Project",description:""}};return delete d.project,d});return console.log(`[RosterApi] Retrieved ${i.length} time logs`),{data:l,error:null}}catch(r){return console.error("[RosterApi] Exception in getTimeLogs:",r),{data:null,error:r}}}static async addTimeLog(e){try{console.log("[RosterApi] Adding new time log:",e);const t={worker_name:e.worker_name,log_date:new Date(e.log_date).toISOString().split("T")[0],hours_worked:parseFloat(e.hours_worked),project_id:e.project_id,activity_description:e.activity_description,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};console.log("[RosterApi] Formatted log data:",t);const{data:s,error:r}=await B.from("time_logs").insert([t]).select().single();return r?(console.error("[RosterApi] Error adding time log:",r),{error:r}):(console.log("[RosterApi] Successfully added time log:",s),{data:s})}catch(t){return console.error("[RosterApi] Error in addTimeLog:",t),{error:t}}}static async updateTimeLog(e,t){try{console.log("[RosterApi] Updating time log:",e,"with data:",t);const s={updated_at:new Date().toISOString()};t.log_date&&(s.log_date=new Date(t.log_date).toISOString().split("T")[0]),t.hours_worked!==void 0&&(s.hours_worked=parseFloat(t.hours_worked)),t.project_id&&(s.project_id=t.project_id),t.activity_description&&(s.activity_description=t.activity_description),console.log("[RosterApi] Formatted update data:",s);const{data:r,error:i}=await B.from("time_logs").update(s).eq("id",e).select().single();return i?(console.error("[RosterApi] Error updating time log:",i),{error:i}):(console.log("[RosterApi] Successfully updated time log:",r),{data:r})}catch(s){return console.error("[RosterApi] Error in updateTimeLog:",s),{error:s}}}static async deleteTimeLog(e){try{console.log("[RosterApi] Deleting time log:",e);const{data:t,error:s}=await B.from("time_logs").delete().eq("id",e).select().single();return s?(console.error("[RosterApi] Error deleting time log:",s),{error:s}):(console.log("[RosterApi] Successfully deleted time log:",t),{data:t})}catch(t){return console.error("[RosterApi] Error in deleteTimeLog:",t),{error:t}}}static async getProjects(){try{const{data:e,error:t}=await B.from("projects").select("*").order("name",{ascending:!0});if(t)throw console.error("[RosterApi] Error fetching projects:",t),t;return e||[]}catch(e){throw console.error("[RosterApi] Error in getProjects:",e),e}}static async checkTablesExist(){console.log("Checking if tables exist...");try{const{data:e,error:t}=await B.from("shifts").select("id").limit(1);if(t)return console.error("Error checking shifts table:",t),{success:!1,error:t};const{data:s,error:r}=await B.from("time_logs").select("id").limit(1);return{success:!0,shiftsExist:!0,timeLogsExist:!r}}catch(e){return console.error("Error checking tables:",e),{success:!1,error:e}}}}const M=$i;class Ct{constructor(e){if(console.log("[Roster] Initializing with container:",e),!e)throw new Error("[Roster] Container element is required");this.container=e,this.container.classList.add("roster-root-container"),this.container.style.height="calc(100vh - 100px)",this.container.style.display="flex",this.container.style.flexDirection="column",this.container.style.overflow="hidden",this.viewRange=6,this.workers=["Toti","Tizi"],this.shifts=[],this.selectedDate=null,this.employees=[],this.modal=null,this.shiftMode="day-night",this.selectedCells=new Set,this.isSelecting=!1,this.selectionStart=null,this.initialize()}async initialize(){try{console.log("[Roster] Starting initialization"),await this.setupUI(),await this.loadInitialData(),console.log("[Roster] Initialization complete")}catch(e){console.error("[Roster] Initialization failed:",e),this.showError("Failed to initialize roster. Please try again.")}}async loadInitialData(){try{console.log("[Roster] Loading initial data");const e=new Date,t=e.getFullYear(),s=e.getMonth(),r=new Date(t,s,1),i=new Date(t,s+this.viewRange,0);console.log("[Roster] Date range:",{startDate:r.toISOString(),endDate:i.toISOString(),viewRange:this.viewRange});const o=await M.checkDatabaseStructure();console.log("[Roster] Database structure check:",o);const[l,a]=await Promise.all([M.getShifts(r,i),M.getEmployees()]);console.log("[Roster] Loaded shifts:",l),console.log("[Roster] Loaded employees:",a),this.workers=(a==null?void 0:a.length)>0?a.map(d=>d.name):["Toti","Tizi"],this.shifts=l||[],this.shifts.forEach(d=>{console.log("[Roster] Shift:",{worker:d.worker_name,date:d.shift_date,type:d.shift_type,is_working:d.is_working})}),this.render()}catch(e){console.error("[Roster] Error loading initial data:",e),this.showError("Failed to load roster data. Please try again.")}}async setupUI(){console.log("[Roster] Setting up UI"),this.container.innerHTML=`
      <div class="roster-container" style="display: flex; flex-direction: column; height: 100%; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <div class="roster-header" style="padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee;">
          <h2>Staff Roster</h2>
          <div class="roster-controls" style="display: flex; gap: 10px; align-items: center;">
            <button id="prevMonth" style="padding: 8px 16px; border: none; border-radius: 4px; background: #007bff; color: white; cursor: pointer;"></button>
            <button id="zoomOut" style="padding: 8px 16px; border: none; border-radius: 4px; background: #007bff; color: white; cursor: pointer;">-</button>
            <span id="viewRangeText">${this.viewRange} months</span>
            <button id="zoomIn" style="padding: 8px 16px; border: none; border-radius: 4px; background: #007bff; color: white; cursor: pointer;">+</button>
            <button id="nextMonth" style="padding: 8px 16px; border: none; border-radius: 4px; background: #007bff; color: white; cursor: pointer;"></button>
          </div>
        </div>
        <div class="gantt-scroll-container" style="flex: 1; overflow: auto; position: relative; border: 1px solid #ddd; margin: 20px; border-radius: 4px;">
          <div class="gantt-content" style="display: flex; flex-direction: column; min-width: fit-content;">
            <div class="timeline" id="timeline" style="border-bottom: 1px solid #ddd; background: #f8f9fa; margin-left: 150px; position: sticky; top: 0; z-index: 2;"></div>
            <div class="roster" id="roster"></div>
          </div>
        </div>
      </div>
      <div id="shift-modal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div class="modal-content" style="background: white; margin: 10% auto; padding: 20px; width: 80%; max-width: 600px; border-radius: 4px; position: relative;">
          <span class="close" style="position: absolute; right: 10px; top: 10px; font-size: 24px; cursor: pointer;">&times;</span>
          <div id="modal-body"></div>
        </div>
      </div>
    `;const e=this.container.querySelector("#zoomIn"),t=this.container.querySelector("#zoomOut"),s=this.container.querySelector("#prevMonth"),r=this.container.querySelector("#nextMonth");if(e&&e.addEventListener("click",()=>{this.viewRange>1&&(this.viewRange--,this.updateView())}),t&&t.addEventListener("click",()=>{this.viewRange<12&&(this.viewRange++,this.updateView())}),s&&s.addEventListener("click",()=>{const o=new Date;o.setMonth(o.getMonth()-1),this.selectedDate=o,this.updateView()}),r&&r.addEventListener("click",()=>{const o=new Date;o.setMonth(o.getMonth()+1),this.selectedDate=o,this.updateView()}),this.modal=this.container.querySelector("#shift-modal"),this.modal){const o=this.modal.querySelector(".close");o&&o.addEventListener("click",()=>this.closeModal())}const i=this.container.querySelector(".roster-header");if(i){const o=document.createElement("div");o.style.display="flex",o.style.alignItems="center",o.style.gap="8px",o.style.marginLeft="20px",o.innerHTML=`
        <label style="font-size:0.95em;">Shift Mode:</label>
        <select id="shiftModeSelect" style="padding:2px 8px; border-radius:3px;">
          <option value="day-night">Day & Night</option>
          <option value="day-only">Day Only</option>
        </select>
      `,i.appendChild(o);const l=o.querySelector("#shiftModeSelect");l.value=this.shiftMode,l.addEventListener("change",a=>{this.shiftMode=a.target.value,this.loadInitialData()})}this.addStyles()}async updateView(){console.log("[Roster] Updating view to",this.viewRange,"months");const e=this.container.querySelector("#viewRangeText");e&&(e.textContent=`${this.viewRange} months`),await this.loadInitialData()}render(){console.log("[Roster] Rendering roster"),this.renderTimeline(),this.renderRoster()}renderTimeline(){const e=this.container.querySelector("#timeline");if(!e){console.error("[Roster] Timeline element not found");return}e.innerHTML="";const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),1),r=new Date(t.getFullYear(),t.getMonth()+this.viewRange,0);console.log("[Roster] Rendering timeline:",{startDate:s.toISOString(),endDate:r.toISOString(),days:Math.ceil((r-s)/(1e3*60*60*24))});const i=Math.ceil((r-s)/(1e3*60*60*24));e.style.display="flex",e.style.minWidth=`${i*50}px`;for(let o=0;o<i;o++){const l=new Date(s);l.setDate(l.getDate()+o);const a=document.createElement("div");a.className="timeline-cell",a.style.width="50px",a.style.minWidth="50px",a.style.height="60px",a.style.borderRight="1px solid #eee",a.style.display="flex",a.style.flexDirection="column",a.style.alignItems="center",a.style.justifyContent="center",a.style.gap="2px";const d=l.toLocaleString("default",{weekday:"short"}),c=document.createElement("div");c.textContent=d,c.style.fontSize="0.7rem",c.style.color="#666",a.appendChild(c);const h=document.createElement("div");if(h.textContent=l.getDate(),h.style.fontSize="0.9rem",a.appendChild(h),l.getDate()===1||o===0){const g=l.toLocaleString("default",{month:"short"}),y=document.createElement("div");y.textContent=g,y.style.fontSize="0.7rem",y.style.opacity="0.7",a.appendChild(y)}l.toDateString()===t.toDateString()&&(a.style.backgroundColor="#f0f7ff",a.style.fontWeight="bold");const u=l.getDay();(u===0||u===6)&&(a.style.backgroundColor="#f5f5f5"),e.appendChild(a)}}renderRoster(){const e=this.container.querySelector("#roster");if(!e){console.error("[Roster] Roster element not found");return}e.innerHTML="",e.style.display="flex",e.style.flexDirection="column";const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),1),r=new Date(t.getFullYear(),t.getMonth()+this.viewRange,0),i=Math.ceil((r-s)/(1e3*60*60*24));this.workers.forEach(l=>{const a=document.createElement("div");a.className="worker-row",a.style.display="flex",a.style.minHeight="60px",a.style.borderBottom="1px solid #eee",a.style.position="relative";const d=document.createElement("div");d.className="worker-name",d.textContent=l,d.style.width="150px",d.style.minWidth="150px",d.style.backgroundColor="#f8f9fa",d.style.borderRight="1px solid #ddd",d.style.display="flex",d.style.alignItems="center",d.style.padding="0 10px",d.style.fontWeight="bold",d.style.position="sticky",d.style.left="0",d.style.zIndex="1",a.appendChild(d);const c=document.createElement("div");c.className="shift-container",c.style.position="relative",c.style.flex="1",c.style.minHeight="60px",c.style.display="flex";for(let h=0;h<i;h++){const u=new Date(s);u.setDate(u.getDate()+h);const g=u.toISOString().split("T")[0],y=`${l}|${g}`,f=this.shifts.find(m=>m.worker_name===l&&m.shift_date===g),p=document.createElement("div");p.className="roster-grid-cell cell",p.style.width="50px",p.style.minWidth="50px",p.style.height="60px",p.style.display="flex",p.style.alignItems="center",p.style.justifyContent="center",p.style.position="relative",p.style.cursor="pointer",p.style.borderRight="1px solid #eee",p.style.background="white",p.setAttribute("data-worker",l),p.setAttribute("data-date",g),p.setAttribute("data-key",y);const T=u.getDay();if((T===0||T===6)&&(p.style.background="#f5f5f5"),u.toDateString()===t.toDateString()&&(p.style.background="#f0f7ff",p.style.fontWeight="bold"),this.selectedCells.has(y)&&(p.style.outline="none",p.style.background="#e3f0ff",p.style.borderRadius="8px",p.style.boxShadow="0 0 0 2px #90caff"),p.addEventListener("click",m=>{if(!m.shiftKey&&!m.ctrlKey&&!m.metaKey&&!this.isSelecting){m.stopPropagation(),m.preventDefault(),this.selectedCells.clear(),this.render(),this.showCellMenu(l,g,f,p,m);return}}),p.addEventListener("mousedown",m=>{!m.shiftKey&&!m.ctrlKey&&!m.metaKey&&(m.preventDefault(),this.isSelecting=!0,this.selectionStart=y,this.selectedCells.clear(),this.selectedCells.add(y))}),p.addEventListener("mouseenter",m=>{this.isSelecting&&(m.buttons===1||m.which===1)&&this.selectionStart&&this.selectRange(this.selectionStart,y)}),p.addEventListener("mouseup",m=>{this.isSelecting&&(this.isSelecting=!1,this.render())}),p.addEventListener("mouseup",()=>{this.isSelecting=!1}),f){const m=document.createElement("div");m.className=`shift ${f.shift_type}`,m.style.width="40px",m.style.height="40px",m.style.borderRadius="4px",m.style.display="flex",m.style.alignItems="center",m.style.justifyContent="center",m.style.color="white",m.style.fontSize="0.8rem",m.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",m.style.pointerEvents="none",f.is_working?(m.style.backgroundColor=f.shift_type==="day"?"#4CAF50":"#2196F3",m.style.opacity="1",m.textContent=f.shift_type==="day"?"D":"N"):(m.style.backgroundColor="#ff9800",m.style.opacity="0.9",m.textContent="RDO"),p.appendChild(m)}else{const m=document.createElement("span");m.textContent="+",m.style.color="#bbb",m.style.fontSize="1.2rem",m.style.opacity="0.5",m.style.pointerEvents="none",p.appendChild(m)}c.appendChild(p)}a.appendChild(c),e.appendChild(a)}),this.selectedCells.size>0&&this.renderBulkActionMenu();const o=l=>{const a=l.target.closest(".roster-grid-cell"),d=l.target.closest("#cell-menu")||l.target.closest("#bulk-action-menu");!a&&!d&&(this.selectedCells.clear(),this.render(),document.removeEventListener("mousedown",o))};document.addEventListener("mousedown",o)}selectRange(e,t){const s=[];this.workers.forEach(o=>{const l=new Date,a=new Date(l.getFullYear(),l.getMonth(),1);for(let d=0;d<this.viewRange*31;d++){const c=new Date(a);c.setDate(c.getDate()+d);const h=c.toISOString().split("T")[0],u=`${o}|${h}`;s.push(u)}});const r=s.indexOf(e),i=s.indexOf(t);if(r!==-1&&i!==-1){const[o,l]=[Math.min(r,i),Math.max(r,i)];this.selectedCells=new Set(s.slice(o,l+1)),this.render()}}renderBulkActionMenu(){let e=document.getElementById("bulk-action-menu");if(e&&e.remove(),this.selectedCells.size<2)return;const t=Array.from(this.selectedCells).map(o=>{const[l,a]=o.split("|"),d=this.shifts.find(c=>c.worker_name===l&&c.shift_date===a);return{key:o,worker:l,date:a,shift:d}}),s=t.some(o=>!o.shift),r=t.some(o=>o.shift);t.some(o=>o.shift&&!o.shift.is_working),t.some(o=>o.shift&&o.shift.is_working),t.some(o=>o.shift&&o.shift.shift_type==="night"),t.some(o=>o.shift&&o.shift.shift_type==="day"),e=document.createElement("div"),e.id="bulk-action-menu",e.style.position="fixed",e.style.bottom="30px",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.background="white",e.style.border="1px solid #b3d1f7",e.style.borderRadius="10px",e.style.boxShadow="0 4px 16px rgba(0,0,0,0.10)",e.style.padding="10px 18px",e.style.zIndex="9999",e.style.display="flex",e.style.gap="12px",e.style.alignItems="center",e.style.fontSize="1.05em";const i=document.createElement("span");if(i.textContent=`${this.selectedCells.size} selected`,i.style.fontWeight="bold",i.style.color="#1976d2",e.appendChild(i),s||r){const o=document.createElement("button");if(o.textContent="Set All to Day",o.style.background="#4CAF50",o.style.color="white",o.style.border="none",o.style.borderRadius="5px",o.style.padding="6px 14px",o.style.cursor="pointer",o.addEventListener("click",async()=>{for(const l of t)l.shift?await M.updateShift(l.shift.id,{shift_type:"day",is_working:!0}):await M.addShift({worker_name:l.worker,shift_type:"day",shift_date:l.date,is_working:!0,notes:""});this.selectedCells.clear(),this.loadInitialData()}),e.appendChild(o),this.shiftMode==="day-night"){const l=document.createElement("button");l.textContent="Set All to Night",l.style.background="#2196F3",l.style.color="white",l.style.border="none",l.style.borderRadius="5px",l.style.padding="6px 14px",l.style.cursor="pointer",l.addEventListener("click",async()=>{for(const a of t)a.shift?await M.updateShift(a.shift.id,{shift_type:"night",is_working:!0}):await M.addShift({worker_name:a.worker,shift_type:"night",shift_date:a.date,is_working:!0,notes:""});this.selectedCells.clear(),this.loadInitialData()}),e.appendChild(l)}}if(r){const o=document.createElement("button");o.textContent="Set to RDO",o.style.background="#ff9800",o.style.color="white",o.style.border="none",o.style.borderRadius="5px",o.style.padding="6px 14px",o.style.cursor="pointer",o.addEventListener("click",async()=>{for(const d of t)d.shift?await M.updateShift(d.shift.id,{is_working:!1}):await M.addShift({worker_name:d.worker,shift_type:"day",shift_date:d.date,is_working:!1,notes:""});this.selectedCells.clear(),this.loadInitialData()}),e.appendChild(o);const l=document.createElement("button");l.textContent="Set to Working",l.style.background="#4CAF50",l.style.color="white",l.style.border="none",l.style.borderRadius="5px",l.style.padding="6px 14px",l.style.cursor="pointer",l.addEventListener("click",async()=>{for(const d of t)d.shift?await M.updateShift(d.shift.id,{is_working:!0}):await M.addShift({worker_name:d.worker,shift_type:"day",shift_date:d.date,is_working:!0,notes:""});this.selectedCells.clear(),this.loadInitialData()}),e.appendChild(l);const a=document.createElement("button");a.textContent="Remove Shift(s)",a.style.background="#e74c3c",a.style.color="white",a.style.border="none",a.style.borderRadius="5px",a.style.padding="6px 14px",a.style.cursor="pointer",a.addEventListener("click",async()=>{for(const d of t.filter(c=>c.shift))await M.deleteShift(d.shift.id);this.selectedCells.clear(),this.loadInitialData()}),e.appendChild(a)}document.body.appendChild(e)}showCellMenu(e,t,s,r,i){console.log("[Roster] Creating cell menu for:",{worker:e,date:t,shift:s});const o=document.getElementById("cell-menu"),l=document.getElementById("bulk-action-menu");o&&o.remove(),l&&l.remove();const a=document.createElement("div");a.id="cell-menu",a.style.position="fixed",a.style.background="white",a.style.border="1px solid #ccc",a.style.borderRadius="8px",a.style.boxShadow="0 8px 24px rgba(0,0,0,0.2)",a.style.padding="12px 16px",a.style.zIndex="99999",a.style.display="flex",a.style.flexDirection="column",a.style.gap="10px",a.style.minWidth="220px",a.style.maxWidth="300px",a.style.transformOrigin="top left",a.style.transition="opacity 0.1s ease",a.style.opacity="0";const d=document.createElement("div");d.style.borderBottom="1px solid #eee",d.style.paddingBottom="8px",d.style.marginBottom="8px",d.style.fontWeight="bold";const c=new Date(t);if(d.textContent=c.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),a.appendChild(d),s){if(this.shiftMode==="day-night"){const C=document.createElement("div");C.style.display="flex",C.style.justifyContent="space-between",C.style.alignItems="center",C.innerHTML="<span>Type:</span>";const V=document.createElement("select");V.style.padding="4px 8px",V.style.borderRadius="3px",V.style.border="1px solid #ddd",V.innerHTML='<option value="day">Day</option><option value="night">Night</option>',V.value=s.shift_type,V.addEventListener("change",async()=>{await M.updateShift(s.id,{shift_type:V.value}),a.remove(),this.loadInitialData()}),C.appendChild(V),a.appendChild(C)}const x=document.createElement("div");x.style.display="flex",x.style.justifyContent="space-between",x.style.alignItems="center",x.style.marginBottom="8px",x.innerHTML="<span>Status:</span>";const _=document.createElement("button");_.textContent=s.is_working?"Working":"RDO",_.style.background=s.is_working?"#4CAF50":"#ff9800",_.style.color="white",_.style.border="none",_.style.borderRadius="3px",_.style.padding="6px 16px",_.style.fontWeight="bold",_.style.cursor="pointer",_.addEventListener("click",async()=>{await M.updateShift(s.id,{is_working:!s.is_working}),a.remove(),this.loadInitialData()}),x.appendChild(_),a.appendChild(x);const E=document.createElement("div");E.style.marginTop="10px";const j=document.createElement("label");j.textContent="Notes:",j.style.display="block",j.style.marginBottom="4px";const q=document.createElement("textarea");q.value=s.notes||"",q.style.width="100%",q.style.minHeight="60px",q.style.padding="8px",q.style.borderRadius="4px",q.style.border="1px solid #ddd",q.style.resize="vertical",q.style.marginBottom="8px",q.placeholder="Add notes about this shift...";const U=document.createElement("button");U.textContent="Save Notes",U.style.background="#007bff",U.style.color="white",U.style.border="none",U.style.borderRadius="3px",U.style.padding="6px 12px",U.style.cursor="pointer",U.style.width="100%",U.addEventListener("click",async()=>{await M.updateShift(s.id,{notes:q.value}),a.remove(),this.loadInitialData()}),E.appendChild(j),E.appendChild(q),E.appendChild(U),a.appendChild(E);const O=document.createElement("button");O.textContent="Remove Shift",O.style.background="#dc3545",O.style.color="white",O.style.border="none",O.style.borderRadius="3px",O.style.padding="6px 12px",O.style.cursor="pointer",O.style.width="100%",O.style.marginTop="8px",O.addEventListener("click",async()=>{confirm("Are you sure you want to remove this shift?")&&(await M.deleteShift(s.id),a.remove(),this.loadInitialData())}),a.appendChild(O)}else{const x=document.createElement("div");if(x.style.display="flex",x.style.flexDirection="column",x.style.gap="8px",this.shiftMode==="day-night"){const E=document.createElement("button");E.textContent="Add Day Shift",E.style.background="#4CAF50",E.style.color="white",E.style.border="none",E.style.borderRadius="3px",E.style.padding="8px 16px",E.style.cursor="pointer",E.addEventListener("click",async()=>{await M.addShift({worker_name:e,shift_type:"day",shift_date:t,is_working:!0,notes:""}),a.remove(),this.loadInitialData()});const j=document.createElement("button");j.textContent="Add Night Shift",j.style.background="#2196F3",j.style.color="white",j.style.border="none",j.style.borderRadius="3px",j.style.padding="8px 16px",j.style.cursor="pointer",j.addEventListener("click",async()=>{await M.addShift({worker_name:e,shift_type:"night",shift_date:t,is_working:!0,notes:""}),a.remove(),this.loadInitialData()}),x.appendChild(E),x.appendChild(j)}else{const E=document.createElement("button");E.textContent="Add Shift",E.style.background="#4CAF50",E.style.color="white",E.style.border="none",E.style.borderRadius="3px",E.style.padding="8px 16px",E.style.cursor="pointer",E.addEventListener("click",async()=>{await M.addShift({worker_name:e,shift_type:"day",shift_date:t,is_working:!0,notes:""}),a.remove(),this.loadInitialData()}),x.appendChild(E)}const _=document.createElement("button");_.textContent="Add RDO",_.style.background="#ff9800",_.style.color="white",_.style.border="none",_.style.borderRadius="3px",_.style.padding="8px 16px",_.style.cursor="pointer",_.addEventListener("click",async()=>{await M.addShift({worker_name:e,shift_type:"day",shift_date:t,is_working:!1,notes:""}),a.remove(),this.loadInitialData()}),x.appendChild(_),a.appendChild(x)}document.body.appendChild(a);const h=a.getBoundingClientRect(),u=window.innerWidth,g=window.innerHeight,y=i?i.clientX:0,f=i?i.clientY:0;let p=y+10,T=f-15;p+h.width>u-20&&(p=y-h.width-10),T+h.height>g-20&&(T=f-h.height-10),p=Math.max(20,Math.min(p,u-h.width-20)),T=Math.max(20,Math.min(T,g-h.height-20)),a.style.left=`${Math.round(p)}px`,a.style.top=`${Math.round(T)}px`,console.log("[Roster] Menu positioned at:",{left:p,top:T,mouseX:y,mouseY:f}),setTimeout(()=>{a.style.opacity="1"},10);const m=document.createElement("div");m.style.position="fixed",m.style.top="0",m.style.left="0",m.style.right="0",m.style.bottom="0",m.style.background="rgba(0,0,0,0.2)",m.style.zIndex="99998",document.body.appendChild(m);const R=x=>{const _=a.contains(x.target),E=r.contains(x.target);!_&&!E&&(a.style.opacity="0",setTimeout(()=>{a.remove(),m.remove()},100),document.removeEventListener("mousedown",R))};document.addEventListener("mousedown",R),a.querySelectorAll("button").forEach(x=>{x.style.transition="all 0.2s ease",x.addEventListener("mouseover",()=>{x.style.filter="brightness(0.9)",x.style.transform="scale(1.02)"}),x.addEventListener("mouseout",()=>{x.style.filter="brightness(1)",x.style.transform="scale(1)"})})}showError(e){const t=document.createElement("div");t.className="error-message",t.textContent=e,this.container.insertBefore(t,this.container.firstChild),setTimeout(()=>{t.remove()},5e3)}openModal(){this.modal.style.display="block"}closeModal(){this.modal.style.display="none"}addStyles(){const e="roster-styles";if(!document.getElementById(e)){const t=document.createElement("style");t.id=e,t.textContent=`
        .roster-container {
          display: flex;
          flex-direction: column;
          height: 100%;
          background: white;
          border-radius: 8px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .roster-header {
          padding: 20px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          border-bottom: 1px solid #eee;
        }

        .roster-controls {
          display: flex;
          gap: 10px;
          align-items: center;
        }

        .gantt-scroll-container {
          flex: 1;
          overflow: auto;
          position: relative;
          border: 1px solid #ddd;
          margin: 20px;
          border-radius: 4px;
        }

        .gantt-content {
          display: flex;
          flex-direction: column;
          min-width: fit-content;
        }

        .timeline {
          display: flex;
          border-bottom: 1px solid #ddd;
          background: #f8f9fa;
          margin-left: 150px;
          position: sticky;
          top: 0;
          z-index: 2;
        }

        .timeline-cell {
          min-width: 50px;
          height: 50px;
          border-right: 1px solid #eee;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          font-size: 0.8rem;
          color: #666;
          padding: 5px;
        }

        .roster {
          display: flex;
          flex-direction: column;
        }

        .worker-row {
          display: flex;
          min-height: 60px;
          border-bottom: 1px solid #eee;
          position: relative;
        }

        .worker-name {
          width: 150px;
          position: sticky;
          left: 0;
          background: #f8f9fa;
          border-right: 1px solid #ddd;
          display: flex;
          align-items: center;
          padding: 0 10px;
          font-weight: bold;
          z-index: 1;
        }

        .shift-container {
          position: relative;
          flex-grow: 1;
          min-height: 60px;
        }

        .shift {
          position: absolute;
          height: 40px;
          top: 50%;
          transform: translateY(-50%);
          border-radius: 4px;
          cursor: pointer;
          transition: all 0.2s ease;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-size: 0.8rem;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .shift:hover {
          transform: translateY(-50%) scale(1.05);
          z-index: 2;
          box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .shift.day {
          background-color: #4CAF50;
        }

        .shift.night {
          background-color: #2196F3;
        }

        .shift.daily {
          opacity: 1;
        }

        .shift.hourly {
          opacity: 0.7;
        }

        .modal {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.5);
          z-index: 1000;
        }

        .modal-content {
          background: white;
          margin: 10% auto;
          padding: 20px;
          width: 80%;
          max-width: 600px;
          border-radius: 4px;
          position: relative;
        }

        .close {
          position: absolute;
          right: 10px;
          top: 10px;
          font-size: 24px;
          cursor: pointer;
        }

        .error-message {
          background: #fee;
          color: #c00;
          padding: 10px;
          margin: 20px;
          border-radius: 4px;
          text-align: center;
        }

        button {
          background: #007bff;
          color: white;
          border: none;
          padding: 8px 16px;
          border-radius: 4px;
          cursor: pointer;
        }

        button:hover {
          background: #0056b3;
        }
      `,document.head.appendChild(t)}}handleCellClick(e){console.log("[Roster] Cell clicked",e);const t=e.currentTarget,s=t.dataset.worker,r=t.dataset.date,i=t.dataset.shiftType;e.shiftKey||e.ctrlKey||e.metaKey||(e.preventDefault(),e.stopPropagation(),this.clearSelection(),this.showCellMenu(t,s,r,i))}setupSelectionHandlers(){this.selectedCells=new Set,this.selectionStart=null,this.isSelecting=!1,document.addEventListener("click",e=>{e.target.closest(".cell")||e.target.closest(".cell-menu")||e.target.closest(".bulk-action-menu")||this.clearSelection()}),this.container.querySelectorAll(".cell").forEach(e=>{e.addEventListener("mousedown",t=>{(t.shiftKey||t.ctrlKey||t.metaKey)&&(t.preventDefault(),this.isSelecting=!0,t.shiftKey&&this.selectionStart?this.selectRange(this.selectionStart,e):(this.toggleCellSelection(e),this.selectionStart=e),this.renderBulkActionMenu())}),e.addEventListener("mouseenter",t=>{this.isSelecting&&t.buttons===1&&(this.toggleCellSelection(e,!0),this.renderBulkActionMenu())})}),document.addEventListener("mouseup",()=>{this.isSelecting=!1})}setupEventListeners(){this.container.querySelectorAll(".cell").forEach(e=>{e.addEventListener("click",this.handleCellClick.bind(this))}),this.setupSelectionHandlers()}}class Rt{constructor(e){if(console.log("[TimeTable] Initializing with container:",e),!e)throw new Error("[TimeTable] Container element is required");this.container=e,this.container.classList.add("timetable-root-container"),this.container.style.height="calc(100vh - 100px)",this.container.style.display="flex",this.container.style.flexDirection="column",this.container.style.overflow="hidden",this.timeLogs=[],this.projects=[],this.currentWorker=null,this.dateRange={start:new Date(new Date().getFullYear(),new Date().getMonth(),1),end:new Date(new Date().getFullYear(),new Date().getMonth()+1,0)},this.employees=[],this.modal=null,this.editingLogId=null,this.initialize()}async initialize(){try{console.log("[TimeTable] Starting initialization"),await this.setupUI(),await this.loadInitialData(),console.log("[TimeTable] Initialization complete")}catch(e){console.error("[TimeTable] Initialization failed:",e),this.showError("Failed to initialize time table. Please try again.")}}async loadInitialData(){try{console.log("[TimeTable] Loading initial data"),this.employees=await M.getEmployees(),this.currentWorker=this.employees[0].name,this.projects=await M.getProjects(),await this.loadTimeLogs(),this.render()}catch(e){console.error("[TimeTable] Error loading initial data:",e),this.showError("Failed to load time table data. Please try again.")}}async loadTimeLogs(){try{if(console.log("[TimeTable] Loading time logs"),!await this.checkTimeLogsTableExists()){console.warn("[TimeTable] time_logs table does not exist yet"),document.getElementById("timeTableWarning").textContent="Time tracking is not set up yet. Please use the controls above to add your first time log.",document.getElementById("timeTableWarning").style.display="block";return}const t=this.dateRange.start.toISOString().split("T")[0],s=this.dateRange.end.toISOString().split("T")[0];console.log(`[TimeTable] Loading time logs for range: ${t} to ${s}`),document.getElementById("timeTableWarning").style.display="none",document.getElementById("timeLogsTable").classList.add("loading");const r=this.employees.find(a=>a.name===this.currentWorker),i=r?r.id:null,{data:o,error:l}=await M.getTimeLogs({startDate:t,endDate:s,workerName:this.currentWorker});if(document.getElementById("timeLogsTable").classList.remove("loading"),l){console.error("[TimeTable] Error loading time logs:",l),document.getElementById("timeTableWarning").textContent="Failed to load time logs. Please try refreshing the page.",document.getElementById("timeTableWarning").style.display="block";return}console.log("[TimeTable] Loaded time logs:",o),this.timeLogs=o||[],this.renderTimeLogs()}catch(e){console.error("[TimeTable] Error in loadTimeLogs:",e),alert("Error loading time logs: "+(e.message||JSON.stringify(e))),document.getElementById("timeTableWarning").textContent="An error occurred while loading time logs. Please try again later.",document.getElementById("timeTableWarning").style.display="block",document.getElementById("timeLogsTable").classList.remove("loading")}}async setupUI(){console.log("[TimeTable] Setting up UI"),this.container.innerHTML=`
      <div class="timetable-container" style="display: flex; flex-direction: column; height: 100%; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <div id="timeTableWarning" style="display:none; color: #dc3545; padding: 10px; font-weight: bold;"></div>
        <div class="timetable-header" style="padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee;">
          <h2>Time Tracking</h2>
          <div class="timetable-controls" style="display: flex; gap: 10px; align-items: center;">
            <button id="prevMonth" style="padding: 8px 16px; border: none; border-radius: 4px; background: #007bff; color: white; cursor: pointer;"></button>
            <span id="dateRangeText"></span>
            <button id="nextMonth" style="padding: 8px 16px; border: none; border-radius: 4px; background: #007bff; color: white; cursor: pointer;"></button>
            <select id="workerSelect" style="padding: 8px 16px; border: 1px solid #ddd; border-radius: 4px;"></select>
          </div>
        </div>
        <div class="timetable-top-actions" style="padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee;">
          <div>
            <button id="addLogBtn" style="padding: 10px 20px; border: none; border-radius: 4px; background: #28a745; color: white; cursor: pointer;">+ Add Time Log</button>
          </div>
          <div>
            <span id="totalHours" style="font-weight: bold; margin-right: 20px;"></span>
            <button id="exportBtn" style="padding: 8px 16px; border: none; border-radius: 4px; background: #6c757d; color: white; cursor: pointer;">Export</button>
            <button id="fixTableBtn" style="padding: 8px 16px; border: none; border-radius: 4px; background: #dc3545; color: white; cursor: pointer; margin-left: 8px;">Verify DB</button>
          </div>
        </div>
        <div class="timetable-content" style="flex: 1; overflow: auto; padding: 20px;">
          <div id="timeTableWarning" style="display:none; color: #dc3545; padding: 10px; font-weight: bold;"></div>
          <table id="timeLogsTable" style="width: 100%; border-collapse: collapse; border: 1px solid #ddd;">
            <thead>
              <tr style="background: #f8f9fa;">
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Date</th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Hours</th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Project</th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Activity Description</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Actions</th>
              </tr>
            </thead>
            <tbody id="timeLogsTableBody"></tbody>
          </table>
        </div>
      </div>
      <div id="time-log-modal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div class="modal-content" style="background: white; margin: 10% auto; padding: 20px; width: 80%; max-width: 600px; border-radius: 4px; position: relative;">
          <span class="close" style="position: absolute; right: 10px; top: 10px; font-size: 24px; cursor: pointer;">&times;</span>
          <h3 id="modalTitle">Add Time Log</h3>
          <form id="timeLogForm" style="margin-top: 20px;">
            <div style="margin-bottom: 15px;">
              <label for="logDate" style="display: block; margin-bottom: 5px;">Date:</label>
              <input type="date" id="logDate" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <div style="margin-bottom: 15px;">
              <label for="hoursWorked" style="display: block; margin-bottom: 5px;">Hours Worked:</label>
              <select id="hoursWorked" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                ${Array.from({length:49},(c,h)=>{const u=(h*.5).toFixed(1);return`<option value="${u}">${u}</option>`}).join("")}
              </select>
            </div>
            <div style="margin-bottom: 15px;">
              <label for="projectSelect" style="display: block; margin-bottom: 5px;">Project:</label>
              <select id="projectSelect" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></select>
            </div>
            <div style="margin-bottom: 15px;">
              <label for="activityDescription" style="display: block; margin-bottom: 5px;">Activity Description:</label>
              <textarea id="activityDescription" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-height: 80px;"></textarea>
            </div>
            <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
              <button type="button" id="cancelBtn" style="padding: 8px 16px; border: none; border-radius: 4px; background: #6c757d; color: white; cursor: pointer;">Cancel</button>
              <button type="submit" id="saveBtn" style="padding: 8px 16px; border: none; border-radius: 4px; background: #28a745; color: white; cursor: pointer;">Save</button>
            </div>
          </form>
        </div>
      </div>
    `;const e=this.container.querySelector("#workerSelect");e&&(e.innerHTML=this.employees.map(c=>`<option value="${c.name}">${c.name}</option>`).join(""),e.addEventListener("change",()=>{this.currentWorker=e.value,this.loadTimeLogs().then(()=>this.render())}));const t=this.container.querySelector("#prevMonth"),s=this.container.querySelector("#nextMonth");t&&t.addEventListener("click",()=>{const c=new Date(this.dateRange.start);c.setMonth(c.getMonth()-1);const h=new Date(c.getFullYear(),c.getMonth()+1,0);this.dateRange={start:c,end:h},this.loadTimeLogs().then(()=>this.render())}),s&&s.addEventListener("click",()=>{const c=new Date(this.dateRange.start);c.setMonth(c.getMonth()+1);const h=new Date(c.getFullYear(),c.getMonth()+1,0);this.dateRange={start:c,end:h},this.loadTimeLogs().then(()=>this.render())});const r=this.container.querySelector("#addLogBtn");r&&r.addEventListener("click",()=>{this.showAddLogModal()});const i=this.container.querySelector("#exportBtn");i&&i.addEventListener("click",()=>{this.exportTimeLogs()});const o=this.container.querySelector("#fixTableBtn");o&&o.addEventListener("click",async()=>{try{o.textContent="Verifying...",o.disabled=!0,await this.verifyDatabase(),o.textContent="Done!",setTimeout(()=>{o.textContent="Verify DB",o.disabled=!1},2e3),this.loadInitialData()}catch(c){console.error("[TimeTable] Error verifying time_logs table:",c),this.showError("Failed to verify time_logs table. Check console for details."),o.textContent="Error",setTimeout(()=>{o.textContent="Verify DB",o.disabled=!1},2e3)}}),this.modal=this.container.querySelector("#time-log-modal");const l=this.modal.querySelector(".close"),a=this.modal.querySelector("#cancelBtn"),d=this.modal.querySelector("#timeLogForm");l.addEventListener("click",()=>{this.hideModal()}),a.addEventListener("click",()=>{this.hideModal()}),d.addEventListener("submit",c=>{c.preventDefault(),this.saveTimeLog()}),window.addEventListener("click",c=>{c.target===this.modal&&this.hideModal()}),this.addStyles()}render(){console.log("[TimeTable] Rendering time table"),this.updateDateRangeText(),this.renderTimeLogs(),this.updateTotalHours()}updateDateRangeText(){const e=this.container.querySelector("#dateRangeText");if(e){const t=this.dateRange.start.toLocaleString("default",{month:"long",year:"numeric"});e.textContent=t}}renderTimeLogs(){const e=this.container.querySelector("#timeLogsTableBody");if(!e)return;if(!this.timeLogs||this.timeLogs.length===0){e.innerHTML=`
        <tr>
          <td colspan="5" style="padding: 20px; text-align: center; color: #666;">
            No time logs found for the selected period.
          </td>
        </tr>
      `,document.getElementById("timeTableWarning").style.display="none";return}e.innerHTML=this.timeLogs.map(r=>{const i=new Date(r.log_date).toLocaleDateString(),o=r.project&&r.project.name?r.project.name:"Unknown Project",l=r.hours_worked||r.hours||0;return`
          <tr data-id="${r.id}" style="border-bottom: 1px solid #ddd;">
            <td style="padding: 12px;">${i}</td>
            <td style="padding: 12px;">${l}</td>
            <td style="padding: 12px;">${o}</td>
            <td style="padding: 12px;">${r.activity_description||""}</td>
            <td style="padding: 12px; text-align: center;">
              <button class="edit-btn" data-id="${r.id}" style="margin-right: 8px; padding: 4px 8px; border: none; border-radius: 4px; background: #007bff; color: white; cursor: pointer;">Edit</button>
              <button class="delete-btn" data-id="${r.id}" style="padding: 4px 8px; border: none; border-radius: 4px; background: #dc3545; color: white; cursor: pointer;">Delete</button>
            </td>
          </tr>
        `}).join("");const t=e.querySelectorAll(".edit-btn"),s=e.querySelectorAll(".delete-btn");t.forEach(r=>{r.addEventListener("click",i=>{const o=i.target.dataset.id;this.editTimeLog(o)})}),s.forEach(r=>{r.addEventListener("click",i=>{const o=i.target.dataset.id;this.deleteTimeLog(o)})}),this.updateTotalHours()}getStatusColor(e){switch(e){case"pending":return"#ffc107";case"approved":return"#28a745";case"rejected":return"#dc3545";default:return"#6c757d"}}updateTotalHours(){const e=this.container.querySelector("#totalHours");if(e&&this.timeLogs&&this.timeLogs.length>0){const t=this.timeLogs.reduce((s,r)=>s+parseFloat(r.hours_worked||r.hours||0),0);e.textContent=`Total Hours: ${t.toFixed(2)}`}else e&&(e.textContent="Total Hours: 0.00")}showAddLogModal(){console.log("[TimeTable] Showing add log modal"),this.editingLogId=null;const e=this.modal.querySelector("#modalTitle");e&&(e.textContent="Add Time Log");const t=this.modal.querySelector("#timeLogForm");t&&t.reset();const s=this.modal.querySelector("#logDate");if(s){const i=new Date;s.value=i.toISOString().split("T")[0]}const r=this.modal.querySelector("#projectSelect");r&&(r.innerHTML=this.projects.map(i=>`<option value="${i.id}">${i.name}</option>`).join("")),this.modal.style.display="block"}async editTimeLog(e){console.log("[TimeTable] Editing time log:",e),this.editingLogId=e;const t=this.timeLogs.find(a=>a.id===e);if(!t)return;const s=this.modal.querySelector("#modalTitle");s&&(s.textContent="Edit Time Log");const r=this.modal.querySelector("#logDate"),i=this.modal.querySelector("#hoursWorked"),o=this.modal.querySelector("#projectSelect"),l=this.modal.querySelector("#activityDescription");r&&(r.value=t.log_date),i&&(i.value=t.hours_worked||t.hours||0),o&&(o.innerHTML=this.projects.map(a=>`<option value="${a.id}" ${a.id===t.project_id?"selected":""}>${a.name}</option>`).join("")),l&&(l.value=t.activity_description),this.modal.style.display="block"}async deleteTimeLog(e){if(confirm("Are you sure you want to delete this time log?"))try{await M.deleteTimeLog(e),await this.loadTimeLogs(),this.render(),this.showSuccess("Time log deleted successfully")}catch(t){console.error("[TimeTable] Error deleting time log:",t),this.showError("Failed to delete time log. Please try again.")}}async saveTimeLog(){try{const e=this.getFormData();if(!e)return;if(this.showLoadingIndicator(!0),!await this.checkTimeLogsTableExists()&&!await this.verifyDatabase()){this.showMessage("Cannot save time log because the time_logs table doesn't exist","error"),this.showLoadingIndicator(!1);return}console.log("[TimeTable] Saving time log:",e);let s;if(this.editingLogId?s=await M.updateTimeLog(this.editingLogId,e):s=await M.addTimeLog(e),s.error)throw new Error(s.error.message||"Failed to save time log");this.showMessage(`Time log ${this.editingLogId?"updated":"added"} successfully!`,"success"),this.hideModal(),this.loadTimeLogs()}catch(e){console.error("[TimeTable] Error saving time log:",e),this.showMessage(`Error: ${e.message||"Failed to save time log"}`,"error")}finally{this.showLoadingIndicator(!1)}}hideModal(){this.modal.style.display="none"}exportTimeLogs(){const e=["Date","Hours","Project","Activity"],t=this.timeLogs.map(o=>{const l=new Date(o.log_date).toLocaleDateString(),a=o.project?o.project.name:"Unknown Project";return[l,o.hours_worked,a,o.activity_description]}),s="data:text/csv;charset=utf-8,"+[e,...t].map(o=>o.join(",")).join(`
`),r=encodeURI(s),i=document.createElement("a");i.setAttribute("href",r),i.setAttribute("download",`time_logs_${this.currentWorker}_${this.dateRange.start.toISOString().slice(0,7)}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i)}showError(e){const t=document.createElement("div");t.className="error-message",t.textContent=e,t.style.position="fixed",t.style.top="20px",t.style.right="20px",t.style.padding="12px 20px",t.style.backgroundColor="#f8d7da",t.style.color="#721c24",t.style.borderRadius="4px",t.style.zIndex="9999",t.style.boxShadow="0 2px 10px rgba(0,0,0,0.1)",document.body.appendChild(t),setTimeout(()=>{t.remove()},5e3)}showSuccess(e){const t=document.createElement("div");t.className="success-message",t.textContent=e,t.style.position="fixed",t.style.top="20px",t.style.right="20px",t.style.padding="12px 20px",t.style.backgroundColor="#d4edda",t.style.color="#155724",t.style.borderRadius="4px",t.style.zIndex="9999",t.style.boxShadow="0 2px 10px rgba(0,0,0,0.1)",document.body.appendChild(t),setTimeout(()=>{t.remove()},5e3)}addStyles(){const e="timetable-styles";if(!document.getElementById(e)){const t=document.createElement("style");t.id=e,t.textContent=`
        .timetable-root-container {
          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        
        .timetable-content table {
          border-collapse: collapse;
          width: 100%;
        }
        
        .timetable-content th, .timetable-content td {
          padding: 12px;
          text-align: left;
          border-bottom: 1px solid #ddd;
        }
        
        .timetable-content tr:hover {
          background-color: #f5f5f5;
        }
        
        .timetable-content th {
          background-color: #f8f9fa;
          border-bottom: 2px solid #ddd;
        }
        
        button {
          cursor: pointer;
          border: none;
          border-radius: 4px;
          padding: 8px 16px;
        }
        
        button:hover {
          opacity: 0.9;
        }
        
        .modal {
          display: none;
          position: fixed;
          z-index: 1000;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
          background-color: white;
          margin: 10% auto;
          padding: 20px;
          width: 80%;
          max-width: 600px;
          border-radius: 4px;
          box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .close {
          float: right;
          font-size: 28px;
          font-weight: bold;
          cursor: pointer;
        }
        
        .close:hover {
          color: #999;
        }
        
        input, select, textarea {
          width: 100%;
          padding: 8px;
          margin-bottom: 15px;
          border: 1px solid #ddd;
          border-radius: 4px;
          box-sizing: border-box;
        }
        
        label {
          display: block;
          margin-bottom: 5px;
          font-weight: 500;
        }
      `,document.head.appendChild(t)}}async verifyDatabase(){try{if(console.log("[TimeTable] Verifying database schema"),!await this.checkTimeLogsTableExists()){console.log("[TimeTable] time_logs table does not exist, creating it now");const t=`
          CREATE TABLE IF NOT EXISTS time_logs (
            id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
            worker_name TEXT NOT NULL,
            log_date DATE NOT NULL,
            hours_worked NUMERIC NOT NULL CHECK (hours_worked > 0 AND hours_worked <= 24),
            project_id UUID REFERENCES projects(id),
            activity_description TEXT,
            status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected')),
            created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
          );

          -- Disable RLS for testing
          ALTER TABLE time_logs DISABLE ROW LEVEL SECURITY;
        `,{error:s}=await B.rpc("exec_sql",{sql:t});return s?(console.error("[TimeTable] Failed to create time_logs table:",s),this.showError("Failed to set up time tracking. Please try again or contact support."),!1):(console.log("[TimeTable] Successfully created time_logs table"),!0)}return console.log("[TimeTable] time_logs table exists"),!0}catch(e){return console.error("[TimeTable] Error verifying database:",e),this.showError("Failed to verify database structure. Please try again or contact support."),!1}}async checkTimeLogsTableExists(){try{const{data:e,error:t}=await B.from("time_logs").select("id").limit(1);return t&&t.code==="42P01"?!1:(t&&console.error("[TimeTable] Error checking time_logs table:",t),!0)}catch(e){return console.error("[TimeTable] Error in checkTimeLogsTableExists:",e),!1}}showLoadingIndicator(e){const t=this.container.querySelector(".loading-indicator");t&&(t.style.display=e?"block":"none")}showMessage(e,t){const s=document.createElement("div");s.className=`message-${t}`,s.textContent=e,s.style.position="fixed",s.style.top="20px",s.style.right="20px",s.style.padding="12px 20px",s.style.borderRadius="4px",s.style.zIndex="9999",s.style.boxShadow="0 2px 10px rgba(0,0,0,0.1)",document.body.appendChild(s),setTimeout(()=>{s.remove()},5e3)}getFormData(){const e=this.modal.querySelector("#logDate").value,t=this.modal.querySelector("#hoursWorked").value,s=this.modal.querySelector("#projectSelect").value,r=this.modal.querySelector("#activityDescription").value;return!e||!t||!s||!r?(this.showError("Please fill in all required fields"),null):{worker_name:this.currentWorker,project_id:s,log_date:e,hours_worked:parseFloat(t),activity_description:r}}}class Ai{constructor(){console.log("NavigationManager constructor called"),this.contentArea=null,this.calendar=null,this.roster=null,this.timeTable=null,this.initialize()}initialize(){console.log("Initializing NavigationManager"),this.setup()}setup(){if(console.log("Setting up NavigationManager"),this.contentArea=document.querySelector(".content"),!this.contentArea){console.error("Content area not found");return}const e=document.querySelectorAll(".nav-button");console.log(`Found ${e.length} navigation buttons`),e.forEach(t=>{console.log(`Button found: ${t.getAttribute("data-section")}`)}),this.setupEventListeners(),console.log("Navigation manager setup complete")}setupEventListeners(){console.log("Setting up event listeners"),document.querySelectorAll(".nav-button").forEach(i=>{console.log(`Adding click listener to button: ${i.getAttribute("data-section")}`);const o=i.cloneNode(!0);i.parentNode.replaceChild(o,i),o.addEventListener("click",l=>{console.log(`Button clicked: ${o.getAttribute("data-section")}`),l.preventDefault(),l.stopPropagation();const a=o.getAttribute("data-section");if(!a){console.error("No data-section attribute found on button");return}const d=o.querySelector(".nav-arrow");if(d){console.log(`Found arrow in button ${a}`);const c=o.parentElement.querySelector(`.nav-subsection[data-parent="${a}"]`);if(c){console.log(`Toggling subsection for ${a}`),c.classList.toggle("active"),d.classList.toggle("active");return}}console.log(`Navigating to section: ${a}`),document.querySelectorAll(".nav-button").forEach(c=>{c.classList.remove("active")}),o.classList.add("active"),this.handleNavigation(a)})});const e=document.querySelector(".theme-toggle");e&&e.addEventListener("click",()=>{const i=document.documentElement,l=i.getAttribute("data-theme")==="light"?"dark":"light";i.setAttribute("data-theme",l),localStorage.setItem("theme",l)});const t=document.querySelector(".search-input"),s=document.querySelector(".search-button");if(t&&s){const i=()=>{const o=t.value.trim();o&&console.log("Search query:",o)};t&&t.addEventListener("keypress",o=>{o.key==="Enter"&&i()}),s.addEventListener("click",i)}const r=document.querySelector("a#time-tracking-tab");r&&r.addEventListener("click",i=>{i.preventDefault(),this.loadTimeTracking()}),console.log("Event listeners setup complete")}async handleNavigation(e){console.log(`Handling navigation for section: ${e}`);try{switch(this.contentArea.innerHTML="",e){case"roster":case"roster-view":console.log("[NavigationManager] Showing roster");try{const t=document.createElement("div");t.style.width="100%",t.style.height="100%",t.style.overflow="auto",t.style.position="relative",t.classList.add("roster-view-container"),this.contentArea.innerHTML="",this.contentArea.appendChild(t),this.roster&&(this.roster=null),this.roster=new Ct(t)}catch(t){console.error("[NavigationManager] Failed to initialize roster:",t),this.contentArea.innerHTML=`
              <div class="error-message">
                Failed to initialize roster. Please try refreshing the page.
              </div>
            `}break;case"roster-add":console.log("Showing add shift"),await this.showAddShift();break;case"roster-settings":console.log("Showing roster settings"),this.showRosterSettings();break;case"time-tracking":console.log("[NavigationManager] Loading Time Tracking"),await this.loadTimeTracking();break;case"calendar":case"calendar-view":console.log("Showing calendar"),await this.showCalendar();break;case"calendar-add":console.log("Showing add event"),await this.showAddEvent();break;case"calendar-settings":console.log("Showing calendar settings"),this.showCalendarSettings();break;case"projects":console.log("Showing projects"),this.showProjectsContent();break;case"samples":console.log("Showing samples"),this.showSamplesContent();break;case"reports":console.log("Showing reports"),this.showReportsContent();break;case"analysis":console.log("Showing analysis tools"),this.showAnalysisTools();break;case"export":console.log("Showing export tools"),this.showExportTools();break;default:console.log("Showing default content"),this.showDefaultContent()}}catch(t){console.error("Navigation error:",t),this.showError("Failed to navigate: "+t.message)}}async showRoster(){console.log("Initializing roster view");try{const e=document.createElement("div");e.className="roster-container",this.contentArea.appendChild(e),this.roster||(this.roster=new Ct(e))}catch(e){console.error("Error showing roster:",e),this.showError("Failed to load roster: "+e.message)}}async showAddShift(){var e;this.contentArea.innerHTML=`
      <div class="add-shift-form">
        <h2>Add New Shift</h2>
        <form id="shiftForm">
          <div class="form-group">
            <label for="employeeName">Employee:</label>
            <select id="employeeName" required>
              <option value="Toti">Toti</option>
              <option value="Tizi">Tizi</option>
            </select>
          </div>
          <div class="form-group">
            <label for="shiftDate">Date:</label>
            <input type="date" id="shiftDate" required>
          </div>
          <div class="form-group">
            <label for="shiftType">Shift Type:</label>
            <select id="shiftType" required>
              <option value="Day">Day Shift</option>
              <option value="Night">Night Shift</option>
              <option value="RDO">RDO (Day Off)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="notes">Notes:</label>
            <textarea id="notes"></textarea>
          </div>
          <button type="submit">Add Shift</button>
        </form>
      </div>
    `,(e=document.getElementById("shiftForm"))==null||e.addEventListener("submit",async t=>{t.preventDefault();const s={worker_name:document.getElementById("employeeName").value,shift_date:document.getElementById("shiftDate").value,shift_type:document.getElementById("shiftType").value,notes:document.getElementById("notes").value};try{await this.roster.addShift(s),this.handleNavigation("roster-view")}catch(r){console.error("Error adding shift:",r),alert("Failed to add shift: "+r.message)}})}showRosterSettings(){var e;this.contentArea.innerHTML=`
      <div class="settings-container">
        <h2>Roster Settings</h2>
        <div class="settings-group">
          <h3>Display Options</h3>
          <label>
            <input type="checkbox" id="showWeekends" checked>
            Show Weekends
          </label>
          <label>
            <input type="checkbox" id="showHolidays" checked>
            Show Public Holidays
          </label>
        </div>
        <div class="settings-group">
          <h3>Notifications</h3>
          <label>
            <input type="checkbox" id="shiftReminders">
            Shift Reminders
          </label>
          <label>
            <input type="checkbox" id="coverageAlerts">
            Coverage Alerts
          </label>
        </div>
        <button id="saveRosterSettings">Save Settings</button>
      </div>
    `,(e=document.getElementById("saveRosterSettings"))==null||e.addEventListener("click",()=>{alert("Settings saved successfully!")})}showError(e){const t=document.createElement("div");t.className="error-message",t.style.cssText="color: red; padding: 1rem; background: #fee; border-radius: 4px; margin: 1rem 0;",t.textContent=e,this.contentArea.appendChild(t)}async showCalendar(){try{this.contentArea.innerHTML='<div class="calendar-container"></div>';const e=this.contentArea.querySelector(".calendar-container");if(!e)throw new Error("Calendar container not found");this.calendar?this.calendar.container=e:this.calendar=new _i(e),await this.calendar.init()}catch(e){console.error("Error showing calendar:",e),this.contentArea.innerHTML=`
        <div class="error-message">
          <h2>Error Loading Calendar</h2>
          <p>There was an error loading the calendar. Please try again.</p>
          <p>Error: ${e.message}</p>
        </div>
      `}}async showAddEvent(){this.calendar||await this.showCalendar();const e=new Date;await this.calendar.showEventModal(e)}showCalendarSettings(){this.contentArea.innerHTML=`
            <div class="content-section">
                <h2>Calendar Settings</h2>
                <div class="settings-form">
                    <div class="form-group">
                        <label>Default View</label>
                        <select id="default-view">
                            <option value="month">Month</option>
                            <option value="week">Week</option>
                            <option value="day">Day</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>First Day of Week</label>
                        <select id="first-day">
                            <option value="0">Sunday</option>
                            <option value="1">Monday</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Time Format</label>
                        <select id="time-format">
                            <option value="12">12-hour</option>
                            <option value="24">24-hour</option>
                        </select>
                    </div>
                    <button class="save-settings">Save Settings</button>
                </div>
            </div>
        `,this.contentArea.querySelector(".save-settings").addEventListener("click",()=>{const t=this.contentArea.querySelector("#default-view").value,s=this.contentArea.querySelector("#first-day").value,r=this.contentArea.querySelector("#time-format").value;localStorage.setItem("calendarSettings",JSON.stringify({defaultView:t,firstDay:s,timeFormat:r})),alert("Settings saved successfully!")})}showDefaultContent(){this.contentArea.innerHTML=`
            <div class="content-placeholder">
                <h1>Welcome to Mylar</h1>
                <p>Select an item from the sidebar to view its contents.</p>
            </div>
        `}showProjectsContent(){this.contentArea.innerHTML=`
            <div class="content-section">
                <h2>Projects</h2>
                <div class="project-list">
                    <div class="project-card">
                        <h3>Alpine Metamorphism</h3>
                        <p>Study of metamorphic rocks in the Alpine region</p>
                    </div>
                </div>
            </div>
        `}showSamplesContent(){this.contentArea.innerHTML=`
            <div class="content-section">
                <h2>Samples</h2>
                <div class="sample-list">
                    <div class="sample-card">
                        <h3>Sample A-001</h3>
                        <p>Type: Metamorphic Rock</p>
                        <p>Location: Alpine Region</p>
                    </div>
                </div>
            </div>
        `}showReportsContent(){this.contentArea.innerHTML=`
            <div class="content-section">
                <h2>Reports</h2>
                <div class="report-list">
                    <div class="report-card">
                        <h3>Initial Analysis Report</h3>
                        <p>Date: 2024-01-20</p>
                        <p>Status: Completed</p>
                    </div>
                </div>
            </div>
        `}showAnalysisTools(){this.contentArea.innerHTML=`
            <div class="content-section">
                <h2>Analysis Tools</h2>
                <div class="tools-grid">
                    <button class="tool-button">
                        <i class="ti ti-chart-bar"></i>
                        <span>XRD Analysis</span>
                    </button>
                    <button class="tool-button">
                        <i class="ti ti-flask"></i>
                        <span>Chemical Analysis</span>
                    </button>
                </div>
            </div>
        `}showExportTools(){this.contentArea.innerHTML=`
            <div class="content-section">
                <h2>Export Data</h2>
                <div class="export-options">
                    <button class="export-button">
                        <i class="ti ti-file-export"></i>
                        <span>Export as CSV</span>
                    </button>
                    <button class="export-button">
                        <i class="ti ti-file-download"></i>
                        <span>Export as PDF</span>
                    </button>
                </div>
            </div>
        `}async loadTimeTracking(){console.log("[NavigationManager] Loading Time Tracking component");try{const e=document.createElement("div");e.id="timeTableContainer",e.style.width="100%",e.style.height="calc(100vh - 100px)",e.style.overflow="auto",e.style.position="relative",this.contentArea.innerHTML="",this.contentArea.appendChild(e),this.timeTable?(console.log("[NavigationManager] Reusing existing TimeTable instance"),this.timeTable=new Rt(e)):(console.log("[NavigationManager] Creating new TimeTable instance"),this.timeTable=new Rt(e))}catch(e){console.error("[NavigationManager] Error loading time tracking:",e),this.contentArea.innerHTML=`
        <div class="error-message">
          <h2>Error Loading Time Tracking</h2>
          <p>There was an error loading the time tracking component. Please try again.</p>
          <p>Error: ${e.message}</p>
        </div>
      `}}}const qi=Object.freeze(Object.defineProperty({__proto__:null,NavigationManager:Ai},Symbol.toStringTag,{value:"Module"}));export{ct as g,qi as n};
